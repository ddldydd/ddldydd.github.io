<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"ddldydd.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="一、Docker概述1. Docker为什么出现？一款产品：开发–上线 两套环境！应用环境，应用配置！ 开发—运维。问题：我在我的电脑上可以运行！版本更新，导致服务不可用！对于运维来说，考验就十分大？ 环境配置十分的麻烦，每一个机器都要部署环境（集群redis、ES、Hadoop。。）！费时费力。 发布一个项目（jar+（Redis MySQL jdk ES）），项目能不能带上环境安装打包！ 之前">
<meta property="og:type" content="article">
<meta property="og:title" content="docker 笔记">
<meta property="og:url" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="夏蝉之家">
<meta property="og:description" content="一、Docker概述1. Docker为什么出现？一款产品：开发–上线 两套环境！应用环境，应用配置！ 开发—运维。问题：我在我的电脑上可以运行！版本更新，导致服务不可用！对于运维来说，考验就十分大？ 环境配置十分的麻烦，每一个机器都要部署环境（集群redis、ES、Hadoop。。）！费时费力。 发布一个项目（jar+（Redis MySQL jdk ES）），项目能不能带上环境安装打包！ 之前">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-1aaafc44430e2fb0ba187c8f61bdc6e2_1440w.webp">
<meta property="og:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-26ee6f7c062fb981c8c5653115251b3c_1440w.webp">
<meta property="og:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-2c4119e49a2da46dca6f86554beef977_1440w.webp">
<meta property="og:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-393963af472be7f5a849143582cb0ec5_1440w.webp">
<meta property="og:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-d941ca3a98a98d6c005492a089ce16f8_1440w.webp">
<meta property="og:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-717747315dd233e8555f9f20da310eb4_1440w.webp">
<meta property="og:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-b07ce47f21897e58cf9e0682ba8fdaf1_1440w.webp">
<meta property="og:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-7c06cb1438a628010da98dcda94bc36d_1440w.webp">
<meta property="og:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-704566e16590938d7df11d17b82eb054_1440w.webp">
<meta property="og:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-88b296c6fd3ef5eb2cfe0f320524db97_1440w.webp">
<meta property="og:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-928ff6d8c5f3b023f89b2819eebc4fd6_1440w.webp">
<meta property="og:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-08f4414acc50b8d043b3c5b23317b3e9_1440w.webp">
<meta property="og:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-3c0bfb6e1bf289d42f65ad6d216f7f77_1440w.webp">
<meta property="og:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-80c0164f0655d33dc83b1b6281e5a95a_1440w.webp">
<meta property="og:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-2a8feb14f02b36352bbd4a5ea2d87aab_1440w.webp">
<meta property="og:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-559a93cdb70a070195ac25744342307a_1440w.webp">
<meta property="og:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-737889c9bf3f917a73b156885abcf5e8_1440w.webp">
<meta property="og:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-0a414b3fe77d3c9365f32a10d5a92851_1440w.webp">
<meta property="og:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-2d3dcf671aabc592f8a427175a888c51_1440w.webp">
<meta property="og:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-62f6ac59bb63d786951795d064df26f3_1440w.webp">
<meta property="og:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-06741390ee09857de8603dd1f26c9dcb_1440w.webp">
<meta property="og:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-c10e578a91dfb416d40bebdfa77bd473_1440w.webp">
<meta property="og:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-c99cfb9af0aa00c82d96e9b8c0eee2fb_1440w.webp">
<meta property="og:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-8bddf8c86c2666516ec5824acc504965_1440w.webp">
<meta property="og:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-c9bae135796b9a2e990de9773ddd0a65_1440w.webp">
<meta property="og:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-8f48654b71c257bedd74d456f8ddf3ea_1440w.webp">
<meta property="og:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-ef784525355a286e40c69a8443e6a481_1440w.webp">
<meta property="og:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-141ac11e311b235a6d5858748a39f2cd_1440w.webp">
<meta property="og:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-4e09155111a78f2a0073be38285a2241_1440w.webp">
<meta property="og:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-4dac5bbaf915c8fade298d757868c437_1440w.webp">
<meta property="og:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-10f2a6ebc35e0037789f01b6518b93b1_1440w.webp">
<meta property="og:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-d2230583e661447f179012637b69c156_1440w.webp">
<meta property="og:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-10f2a6ebc35e0037789f01b6518b93b1_1440w.webp">
<meta property="og:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-83bc0a1349dab2d71492e13e6c5b144c_1440w.webp">
<meta property="og:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-f7ddd5fe1a5e6e6c739a89978e71c883_1440w.webp">
<meta property="og:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-814bc378b5bc8eb04b895df7743dc92c_1440w.png">
<meta property="og:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-2077c77569ba336c2e1ccfa46548e4ca_1440w.webp">
<meta property="og:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-206af31f11f8121e681415fb3779626f_1440w.webp">
<meta property="og:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-d0f186f0fdc9524db88dc50456a34891_1440w.webp">
<meta property="og:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-2d1143b9bde6164b0517cd7f6c9bd5cf_1440w.webp">
<meta property="og:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-8da5b050d26178cc4345df0673bd55ad_1440w.webp">
<meta property="og:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-e192d7b4e728550f7fe8ef2a15fe45d6_1440w.webp">
<meta property="og:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-90b0d774dc7392783d156ca7e8872c1d_1440w.webp">
<meta property="og:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-1fc810b62eccd42fd4548a9253639f54_1440w.png">
<meta property="og:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-01ef4e6f3ac02d04738bad76e2b301d6_1440w.webp">
<meta property="og:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-ad76d0797c9832e68d9686b007cb2954_1440w.webp">
<meta property="article:published_time" content="2024-02-22T14:15:40.000Z">
<meta property="article:modified_time" content="2024-02-22T14:16:54.080Z">
<meta property="article:author" content="阿呆">
<meta property="article:tag" content="docker">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-1aaafc44430e2fb0ba187c8f61bdc6e2_1440w.webp">

<link rel="canonical" href="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>docker 笔记 | 夏蝉之家</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">夏蝉之家</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-commonweal">

    <a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>公益 404</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container"></div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="algolia-results">
  <div id="algolia-stats"></div>
  <div id="algolia-hits"></div>
  <div id="algolia-pagination" class="algolia-pagination"></div>
</div>

      
    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="阿呆">
      <meta itemprop="description" content="书山有路勤为径，学海无涯苦作舟。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="夏蝉之家">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          docker 笔记
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2024-02-22 22:15:40 / 修改时间：22:16:54" itemprop="dateCreated datePublished" datetime="2024-02-22T22:15:40+08:00">2024-02-22</time>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>69k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2:05</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h3 id="一、Docker概述"><a href="#一、Docker概述" class="headerlink" title="一、Docker概述"></a>一、Docker概述</h3><h3 id="1-Docker为什么出现？"><a href="#1-Docker为什么出现？" class="headerlink" title="1. Docker为什么出现？"></a>1. Docker为什么出现？</h3><p>一款产品：开发–上线 两套环境！应用环境，应用配置！</p>
<p>开发—运维。问题：我在我的电脑上可以运行！版本更新，导致服务不可用！对于运维来说，考验就十分大？</p>
<p>环境配置十分的麻烦，每一个机器都要部署环境（集群redis、ES、Hadoop。。）！费时费力。</p>
<p>发布一个项目（jar+（Redis MySQL jdk ES）），项目能不能带上环境安装打包！</p>
<p>之前在服务器配置一个应用的环境 Redis MySQL jdk ES Hadoop，配置超麻烦了，不能够跨平台。</p>
<p>Windows，最后发布到Linux！</p>
<p>传统：开发jar，运维来做！</p>
<p>现在：开发打包部署上线，一套流程做完！</p>
<p>java — apk — 发布（应用商店） — 张三使用apk — 安装即可用！</p>
<p>java — jar（环境） — 打包项目带上环境（镜像） — （Docker仓库：商店） — 下载我们发布的镜像 — 直接运行即可！</p>
<p>Docker给以上的问题，提出了解决方案！</p>
<p><img src="/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-1aaafc44430e2fb0ba187c8f61bdc6e2_1440w.webp" alt="img"></p>
<p>Docker的思想就来自于集装箱！</p>
<p>JRE — 多个应用（端口冲突）— 原来都是交叉的！</p>
<p>隔离：Docker核心思想！打包装箱！每个箱子是互相隔离的。</p>
<p>Docker通过隔离机制，可以将服务器利用到极致！</p>
<p>本质：所有的技术都是因为出现了一些问题，我们需要去解决，才去学习！</p>
<h3 id="2-Docker的历史"><a href="#2-Docker的历史" class="headerlink" title="2. Docker的历史"></a>2. Docker的历史</h3><p>2010年，几个搞IT的年轻人，就在美国成立了一家公司<code>dotCloud</code></p>
<p>做一些PaaS的云计算服务！LXC有关的容器技术！</p>
<p>他们将自己的技术（容器化技术）命名，就是Docker！</p>
<p>Docker刚刚诞生的时候，没有引起行业的注意！dotCloud就活不下去！</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">开源</span><br></pre></td></tr></table></figure>

<p>开放源代码！</p>
<p>2013年，Docker开源！</p>
<p>Docker越来越多的人发现了Docker的优点！火了，Docker每个月都会更新一个版本！</p>
<p>2014年4月9日，Docker1.0发布！</p>
<p>Docker为什么这么火？十分的轻巧！</p>
<p>在容器技术出来之前，我们都是使用虚拟机技术！</p>
<p>虚拟机：在windows中装一个VMware，通过这个软件我们可以虚拟出来一台或者多台电脑！笨重！</p>
<p>虚拟机也是属于虚拟化技术，Docker容器技术也是一种虚拟化技术！</p>
<blockquote>
<p>VM：Linux CentOS原生镜像（一个电脑！）隔离，需要开启多个虚拟机！几个G，几分钟！<br>Docker：隔离，镜像（最核心的环境4M+jdk+mysql）十分的小巧，运行镜像就可以了！几个M，KB，秒级启动！</p>
</blockquote>
<p>到现在，所有开发人员都必须要会Docker！</p>
<p>Docker是基于Go语言开发的！开源项目！</p>
<p>官网：<a href="https://link.zhihu.com/?target=https://www.docker.com/">https://www.docker.com/</a></p>
<p><img src="/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-26ee6f7c062fb981c8c5653115251b3c_1440w.webp" alt="img"></p>
<p>文档地址：<a href="https://link.zhihu.com/?target=https://docs.docker.com/">https://docs.docker.com/</a> Docker的文档是超级详细的！</p>
<p>仓库地址：<a href="https://link.zhihu.com/?target=https://hub.docker.com/">https://hub.docker.com/</a></p>
<h3 id="3-Docker能干嘛？"><a href="#3-Docker能干嘛？" class="headerlink" title="3. Docker能干嘛？"></a>3. Docker能干嘛？</h3><blockquote>
<p>之前的虚拟机技术！</p>
</blockquote>
<p><img src="/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-2c4119e49a2da46dca6f86554beef977_1440w.webp" alt="img"></p>
<p>虚拟机技术缺点：</p>
<p>1、资源占用十分多</p>
<p>2、冗余步骤多</p>
<p>3、启动很慢！</p>
<blockquote>
<p>容器化技术</p>
</blockquote>
<p>容器化技术不是模拟一个完整的操作系统</p>
<p><img src="/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-393963af472be7f5a849143582cb0ec5_1440w.webp" alt="img"></p>
<p>比较Docker和虚拟机技术的不同：</p>
<ul>
<li>传统虚拟机，虚拟出一套硬件，运行一个完整的操作系统，然后在这个系统上安装和运行软件</li>
<li>容器内的应用直接运行在宿主机的内部，容器是没有自己的内核的，也没有虚拟我们的硬件，所以就轻便了</li>
<li>每个容器间是互相隔离，每个容器内都有一个属于自己的文件系统，互不影响。</li>
</ul>
<blockquote>
<p>DevOps（开发、运维）</p>
</blockquote>
<p><strong>应用更快速的交付和部署</strong></p>
<p>传统：一堆帮助文档，安装程序</p>
<p>Docker：打包镜像发布测试，一键运行</p>
<p><strong>更便捷的升级和扩容</strong></p>
<p>使用了Docker之后，我们部署应用就和搭积木一样！</p>
<p>项目打包为一个镜像，扩展 服务器A！服务器B！</p>
<p><strong>更简单的系统运维</strong></p>
<p>在容器化之后，我们的开发、测试环境都是高度一致的。</p>
<p><strong>更高效的计算资源利用</strong></p>
<p>Docker是内核级别的虚拟化，可以在一个物理机上运行很多的容器实例！服务器的性能可以被压榨到极致。</p>
<h3 id="二、Docker安装"><a href="#二、Docker安装" class="headerlink" title="二、Docker安装"></a>二、Docker安装</h3><h3 id="1-Docker的基本组成"><a href="#1-Docker的基本组成" class="headerlink" title="1. Docker的基本组成"></a>1. Docker的基本组成</h3><p><img src="/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-d941ca3a98a98d6c005492a089ce16f8_1440w.webp" alt="img"></p>
<p><strong>镜像（image）：</strong></p>
<p>docker镜像就好比是一个模板，可以通过这个模板来创建容器服务，tomcat镜像 &#x3D;&#x3D;&#x3D;&gt; run &#x3D;&#x3D;&#x3D;&gt; tomcat01容器（提供服务器），通过这个镜像可以创建多个容器（最终服务运行或者项目运行就是在容器中的）。</p>
<p><strong>容器（container）：</strong></p>
<p>Docker利用容器技术，独立运行一个或者一组应用，通过镜像来创建的。</p>
<p>启动，停止，删除，基本命令！</p>
<p>目前就可以把这个容器理解为就是一个简单的linux系统</p>
<p><strong>仓库（repository）：</strong></p>
<p>仓库就是存放镜像的地方！</p>
<p>仓库分为公有仓库和私有仓库！</p>
<p>Docker Hub（默认是国外的）</p>
<p>阿里云等都有容器服务器（配置镜像加速！）</p>
<h3 id="2-安装Docker"><a href="#2-安装Docker" class="headerlink" title="2. 安装Docker"></a>2. 安装Docker</h3><blockquote>
<p>环境查看</p>
</blockquote>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># 内核</span><br><span class="line">grx@ubuntu:~$ uname -r</span><br><span class="line">4.15.0-45-generic</span><br><span class="line"># 系统版本</span><br><span class="line">grx@ubuntu:~$ cat /etc/os-release </span><br><span class="line">NAME=&quot;Ubuntu&quot;</span><br><span class="line">VERSION=&quot;16.04.6 LTS (Xenial Xerus)&quot;</span><br><span class="line">ID=ubuntu</span><br><span class="line">ID_LIKE=debian</span><br><span class="line">PRETTY_NAME=&quot;Ubuntu 16.04.6 LTS&quot;</span><br><span class="line">VERSION_ID=&quot;16.04&quot;</span><br><span class="line">HOME_URL=&quot;http://www.ubuntu.com/&quot;</span><br><span class="line">SUPPORT_URL=&quot;http://help.ubuntu.com/&quot;</span><br><span class="line">BUG_REPORT_URL=&quot;http://bugs.launchpad.net/ubuntu/&quot;</span><br><span class="line">VERSION_CODENAME=xenial</span><br><span class="line">UBUNTU_CODENAME=xenial</span><br></pre></td></tr></table></figure>

<blockquote>
<p>安装</p>
</blockquote>
<p>帮助文档：<a href="https://link.zhihu.com/?target=https://www.runoob.com/docker/ubuntu-docker-install.html">https://www.runoob.com/docker/ubuntu-docker-install.html</a></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">curl -sSL https://get.daocloud.io/docker | sh</span><br><span class="line"># 使用docker version查看是否安装成功</span><br><span class="line">grx@ubuntu:~$ docker version</span><br><span class="line">Client: Docker Engine - Community</span><br><span class="line"> Version:           20.10.2</span><br><span class="line"> API version:       1.41</span><br><span class="line"> Go version:        go1.13.15</span><br><span class="line"> Git commit:        2291f61</span><br><span class="line"> Built:             Mon Dec 28 16:17:29 2020</span><br><span class="line"> OS/Arch:           linux/amd64</span><br><span class="line"> Context:           default</span><br><span class="line"> Experimental:      true</span><br><span class="line"></span><br><span class="line">Server: Docker Engine - Community</span><br><span class="line"> Engine:</span><br><span class="line">  Version:          20.10.2</span><br><span class="line">  API version:      1.41 (minimum version 1.12)</span><br><span class="line">  Go version:       go1.13.15</span><br><span class="line">  Git commit:       8891c58</span><br><span class="line">  Built:            Mon Dec 28 16:15:23 2020</span><br><span class="line">  OS/Arch:          linux/amd64</span><br><span class="line">  Experimental:     false</span><br><span class="line"> containerd:</span><br><span class="line">  Version:          1.4.3</span><br><span class="line">  GitCommit:        269548fa27e0089a8b8278fc4fc781d7f65a939b</span><br><span class="line"> runc:</span><br><span class="line">  Version:          1.0.0-rc92</span><br><span class="line">  GitCommit:        ff819c7e9184c13b7c2607fe6c30ae19403a7aff</span><br><span class="line"> docker-init:</span><br><span class="line">  Version:          0.19.0</span><br><span class="line">  GitCommit:        de40ad0</span><br><span class="line"></span><br><span class="line"># hello world</span><br><span class="line">grx@ubuntu:~$ sudo docker run hello-world</span><br><span class="line">Unable to find image &#x27;hello-world:latest&#x27; locally</span><br><span class="line">latest: Pulling from library/hello-world</span><br><span class="line">0e03bdcc26d7: Pull complete </span><br><span class="line">Digest: sha256:1a523af650137b8accdaed439c17d684df61ee4d74feac151b5b337bd29e7eec</span><br><span class="line">Status: Downloaded newer image for hello-world:latest</span><br><span class="line"></span><br><span class="line">Hello from Docker!</span><br><span class="line">This message shows that your installation appears to be working correctly.</span><br><span class="line"></span><br><span class="line">To generate this message, Docker took the following steps:</span><br><span class="line"> 1. The Docker client contacted the Docker daemon.</span><br><span class="line"> 2. The Docker daemon pulled the &quot;hello-world&quot; image from the Docker Hub.</span><br><span class="line">    (amd64)</span><br><span class="line"> 3. The Docker daemon created a new container from that image which runs the</span><br><span class="line">    executable that produces the output you are currently reading.</span><br><span class="line"> 4. The Docker daemon streamed that output to the Docker client, which sent it</span><br><span class="line">    to your terminal.</span><br><span class="line"></span><br><span class="line">To try something more ambitious, you can run an Ubuntu container with:</span><br><span class="line"> $ docker run -it ubuntu bash</span><br><span class="line"></span><br><span class="line">Share images, automate workflows, and more with a free Docker ID:</span><br><span class="line"> https://hub.docker.com/</span><br><span class="line"></span><br><span class="line">For more examples and ideas, visit:</span><br><span class="line"> https://docs.docker.com/get-started/</span><br><span class="line"></span><br><span class="line"># 查看下载的hello-world镜像</span><br><span class="line">grx@ubuntu:~$ docker images</span><br><span class="line">REPOSITORY    TAG          IMAGE ID       CREATED         SIZE</span><br><span class="line">hello-world   latest       bf756fb1ae65   12 months ago   13.3kB</span><br><span class="line"></span><br><span class="line"># 配置阿里云镜像加速</span><br><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://a8u1hj0d.mirror.aliyuncs.com&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>

<h3 id="3-回顾Hello-World过程"><a href="#3-回顾Hello-World过程" class="headerlink" title="3. 回顾Hello World过程"></a>3. 回顾Hello World过程</h3><h3 id="4-底层原理"><a href="#4-底层原理" class="headerlink" title="4. 底层原理"></a>4. 底层原理</h3><p><strong>Docker是怎么工作的？</strong></p>
<p>Docker是一个Client-Server结构的系统，Docker的守护进程运行在宿主机上，通过Socket从客户端访问！</p>
<p>Docker Server接受到Docker Client的指令，就会执行这个命令！</p>
<p><img src="/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-717747315dd233e8555f9f20da310eb4_1440w.webp" alt="img"></p>
<p><strong>Docker为什么比VM快？</strong></p>
<p>1、Docker有着比虚拟机更少的抽象层</p>
<p>2、Docker利用的是宿主机的内核，VM需要的是Guest O</p>
<p>所以说，新建一个容器的时候，Docker不需要像虚拟机一样重新加载一个操作系统内核，避免引导。虚拟机是加载Guest OS，分钟级别的，而Docker是利用宿主机的操作系统，省略了这个复杂的过程，秒级！</p>
<h3 id="三、Docker的常用命令"><a href="#三、Docker的常用命令" class="headerlink" title="三、Docker的常用命令"></a>三、Docker的常用命令</h3><h3 id="1-帮助命令"><a href="#1-帮助命令" class="headerlink" title="1. 帮助命令"></a>1. 帮助命令</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker version      # 显示docker的版本信息</span><br><span class="line">docker info         # 显示docker的系统信息，包括镜像和容器的数量</span><br><span class="line">docker --help       # 帮助命令</span><br></pre></td></tr></table></figure>

<h3 id="2-镜像命令"><a href="#2-镜像命令" class="headerlink" title="2. 镜像命令"></a>2. 镜像命令</h3><p><strong>docker images</strong> 查看所有本地的镜像</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">grx@ubuntu:~$ docker images</span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">hello-world   latest    bf756fb1ae65   12 months ago   13.3kB</span><br><span class="line"></span><br><span class="line"># 解释</span><br><span class="line">REPOSITORY  镜像的仓库源</span><br><span class="line">TAG         镜像的标签</span><br><span class="line">IMAGE ID    镜像的id</span><br><span class="line">CREATED     镜像的创建时间</span><br><span class="line">SIZE        镜像的大小</span><br><span class="line"></span><br><span class="line"># 可选项</span><br><span class="line">-a, --all       # 列出所有镜像</span><br><span class="line">-q, --quiet     # 只显示镜像的id</span><br></pre></td></tr></table></figure>

<p><strong>docker search</strong> 搜索镜像</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">grx@ubuntu:~$ docker search mysql --filter=STARS=3000</span><br><span class="line">NAME      DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class="line">mysql     MySQL is a widely used, open-source relation…   10380     [OK]</span><br><span class="line">mariadb   MariaDB is a community-developed fork of MyS…   3848      [OK]</span><br><span class="line"></span><br><span class="line"># 可选项</span><br><span class="line">--filter=STARS=3000     # 搜索出来的镜像就是STARS大于等于3000的</span><br></pre></td></tr></table></figure>

<p><strong>docker pull</strong> 下载镜像</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"># 下载镜像 docker pull 镜像名[:tag]</span><br><span class="line">grx@ubuntu:~$ docker pull mysql</span><br><span class="line">Using default tag: latest               # 如果不写tag，默认是latest</span><br><span class="line">latest: Pulling from library/mysql</span><br><span class="line">a076a628af6f: Pull complete             # 分层下载，docker image的核心，联合文件系统。</span><br><span class="line">f6c208f3f991: Pull complete</span><br><span class="line">88a9455a9165: Pull complete</span><br><span class="line">406c9b8427c6: Pull complete</span><br><span class="line">7c88599c0b25: Pull complete</span><br><span class="line">25b5c6debdaf: Pull complete</span><br><span class="line">43a5816f1617: Pull complete</span><br><span class="line">69dd1fbf9190: Pull complete</span><br><span class="line">5346a60dcee8: Pull complete</span><br><span class="line">ef28da371fc9: Pull complete</span><br><span class="line">fd04d935b852: Pull complete</span><br><span class="line">050c49742ea2: Pull complete</span><br><span class="line">Digest: sha256:0fd2898dc1c946b34dceaccc3b80d38b1049285c1dab70df7480de62265d6213</span><br><span class="line">Status: Downloaded newer image for mysql:latest</span><br><span class="line">docker.io/library/mysql:latest          # 真实地址</span><br><span class="line"></span><br><span class="line"># 等价于它</span><br><span class="line">docker pull mysql</span><br><span class="line">docker pull docker.io/library/mysql:latest</span><br><span class="line"></span><br><span class="line"># 指定版本下载</span><br><span class="line">grx@ubuntu:~$ docker pull mysql:5.7</span><br><span class="line">5.7: Pulling from library/mysql</span><br><span class="line">a076a628af6f: Already exists</span><br><span class="line">f6c208f3f991: Already exists</span><br><span class="line">88a9455a9165: Already exists</span><br><span class="line">406c9b8427c6: Already exists</span><br><span class="line">7c88599c0b25: Already exists</span><br><span class="line">25b5c6debdaf: Already exists</span><br><span class="line">43a5816f1617: Already exists</span><br><span class="line">7065aaa2655f: Pull complete</span><br><span class="line">b4bc531db40f: Pull complete</span><br><span class="line">8c3e9d7c9815: Pull complete</span><br><span class="line">fadfb9734ed2: Pull complete</span><br><span class="line">Digest: sha256:e08834258fcc0efd01df358222333919df53d4a0d9b2a54da05b204b822e3b7b</span><br><span class="line">Status: Downloaded newer image for mysql:5.7</span><br><span class="line">docker.io/library/mysql:5.7</span><br><span class="line">grx@ubuntu:~$ docker images</span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">mysql         5.7       cc8775c0fe94   2 days ago      449MB</span><br><span class="line">mysql         latest    d4c3cafb11d5   2 days ago      545MB</span><br><span class="line">hello-world   latest    bf756fb1ae65   12 months ago   13.3kB</span><br></pre></td></tr></table></figure>

<p><strong>docker rmi</strong> 删除镜像</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker rmi -f &lt;镜像id&gt;                # 删除指定的镜像</span><br><span class="line">docker rmi -f &lt;镜像一id&gt; &lt;镜像二id&gt;...        # 删除多个镜像</span><br><span class="line">docker rmi -f $(docker images -aq)          # 删除全部镜像</span><br></pre></td></tr></table></figure>

<h3 id="3-容器命令"><a href="#3-容器命令" class="headerlink" title="3. 容器命令"></a>3. 容器命令</h3><p>说明：我们有了镜像才可以创建容器，下载一个centos来测试学习</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull centos</span><br></pre></td></tr></table></figure>

<p><strong>新建容器并启动</strong></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">docker run [可选参数] image</span><br><span class="line"></span><br><span class="line"># 参数说明</span><br><span class="line">--name=&quot;Name&quot;   容器名字  tomcat01，tomcat02用来区分容器</span><br><span class="line">-d              后台方式运行</span><br><span class="line">-it             使用交互方式运行，进入容器查看内容</span><br><span class="line">-p              指定容器的端口 -p 8080:8080</span><br><span class="line">    -p ip:主机端口:容器端口</span><br><span class="line">    -p 主机端口:容器端口（常用）</span><br><span class="line">    -p 容器端口</span><br><span class="line">    容器端口</span><br><span class="line">-P              随机指定端口</span><br><span class="line"></span><br><span class="line"># 测试，启动并进入容器</span><br><span class="line">grx@ubuntu:~$ docker run -it centos /bin/bash</span><br><span class="line">[root@404f3411db81 /]# ls   # 查看容器内的centos，基础版本，很多命令都是不完善的！</span><br><span class="line">bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line"># 从容器中退回主机</span><br><span class="line">[root@404f3411db81 /]# exit</span><br><span class="line">exit</span><br><span class="line">grx@ubuntu:~$</span><br></pre></td></tr></table></figure>

<p><strong>列出所有运行中的容器</strong></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># docker ps命令</span><br><span class="line">        # 列出当前正在运行的容器</span><br><span class="line">-a      # 列出当前以及历史运行过的容器</span><br><span class="line">-n=?    # 显示最近创建的容器</span><br><span class="line">-q      # 只显示容器的编号</span><br><span class="line"></span><br><span class="line">grx@ubuntu:~$ docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line">grx@ubuntu:~$ docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE         COMMAND       CREATED         STATUS                     PORTS     NAMES</span><br><span class="line">404f3411db81   centos        &quot;/bin/bash&quot;   4 minutes ago   Exited (0) 2 minutes ago             youthful_germain</span><br><span class="line">6b5a4d54c5a2   hello-world   &quot;/hello&quot;      3 days ago      Exited (0) 3 days ago                compassionate_sanderson</span><br></pre></td></tr></table></figure>

<p><strong>退出容器</strong></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">exit        # 直接停止容器并退出</span><br><span class="line">Ctrl+P+Q    # 不停止容器退出</span><br></pre></td></tr></table></figure>

<p><strong>删除容器</strong></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker rm &lt;容器id&gt;                # 删除指定的容器，不能删除正在运行的容器，如果要强制删除加-f</span><br><span class="line">docker rm -f $(docker ps -aq)       # 删除所有的容器</span><br><span class="line">docker rm -a -q|xargs docker rm     # 删除所有的容器</span><br></pre></td></tr></table></figure>

<p><strong>启动和停止容器的操作</strong></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker start &lt;容器id&gt;     # 启动容器</span><br><span class="line">docker restart &lt;容器id&gt;   # 重启容器</span><br><span class="line">docker stop &lt;容器id&gt;      # 停止当前正在运行的容器</span><br><span class="line">docker kill &lt;容器id&gt;      # 强制停止当前容器</span><br></pre></td></tr></table></figure>

<h3 id="4-常用其他命令"><a href="#4-常用其他命令" class="headerlink" title="4. 常用其他命令"></a>4. 常用其他命令</h3><p><strong>后台启动容器</strong></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 命令 docker run -d 镜像名</span><br><span class="line"></span><br><span class="line">grx@ubuntu:~$ docker run -d centos</span><br><span class="line">012048c9c41e3ef3a08790f4d10423ef1705f545ce6e42b9721d46b2eb85b489</span><br><span class="line"></span><br><span class="line"># 问题，docker ps发现centos停止了</span><br><span class="line">grx@ubuntu:~$ docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line"></span><br><span class="line"># 常见的坑：docker容器使用后台运行，就必须要有一个前台进程，docker发现没有应用，就会自动停止</span><br><span class="line"># nginx，容器启动后，发现自己没有提供服务，就会立刻停止，就是没有程序了</span><br></pre></td></tr></table></figure>

<p><strong>查看日志</strong></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># docker logs -f -t --tail n 容器id</span><br><span class="line"></span><br><span class="line"># 自己编写一段shell脚本</span><br><span class="line">grx@ubuntu:~$ docker run -d centos /bin/sh -c &quot;while true;do echo hello;sleep 1;done&quot;</span><br><span class="line">72fb134a68bac8eb736b197fe66b3a7ea9cf726eb16609c2ec145f62979bcec8</span><br><span class="line"></span><br><span class="line">grx@ubuntu:~$ docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS         PORTS     NAMES</span><br><span class="line">72fb134a68ba   centos    &quot;/bin/sh -c &#x27;while t…&quot;   5 seconds ago   Up 4 seconds             infallible_leavitt</span><br><span class="line"></span><br><span class="line"># 显示日志</span><br><span class="line"># -t    时间戳</span><br><span class="line"># -f    跟随日志输出</span><br><span class="line"># --tail n  最后n行</span><br><span class="line">grx@ubuntu:~$ docker logs -tf --tail 5 72fb134a68ba</span><br><span class="line">2021-01-15T02:40:24.870548948Z hello</span><br><span class="line">2021-01-15T02:40:25.874301266Z hello</span><br><span class="line">2021-01-15T02:40:26.877811977Z hello</span><br><span class="line">2021-01-15T02:40:27.881857315Z hello</span><br><span class="line">2021-01-15T02:40:28.887191319Z hello</span><br></pre></td></tr></table></figure>

<p><strong>查看容器中的进程信息</strong></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># docker top 容器id</span><br><span class="line">grx@ubuntu:~$ docker top 72fb134a68ba</span><br><span class="line">UID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD</span><br><span class="line">root                6410                6379                0                   10:40               ?                   00:00:00            /bin/sh -c while true;do echo hello;sleep 1;done</span><br><span class="line">root                6955                6410                0                   10:44               ?                   00:00:00            /usr/bin/coreutils --coreutils-prog-shebang=sleep /usr/bin/sleep 1</span><br></pre></td></tr></table></figure>

<p><strong>查看镜像的元数据</strong></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br></pre></td><td class="code"><pre><span class="line"># 命令 docker inspect 容器id</span><br><span class="line"></span><br><span class="line"># 测试</span><br><span class="line">grx@ubuntu:~$ docker inspect 72fb134a68ba</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Id&quot;: &quot;72fb134a68bac8eb736b197fe66b3a7ea9cf726eb16609c2ec145f62979bcec8&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2021-01-15T02:40:09.91298963Z&quot;,</span><br><span class="line">        &quot;Path&quot;: &quot;/bin/sh&quot;,</span><br><span class="line">        &quot;Args&quot;: [</span><br><span class="line">            &quot;-c&quot;,</span><br><span class="line">            &quot;while true;do echo hello;sleep 1;done&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;State&quot;: &#123;</span><br><span class="line">            &quot;Status&quot;: &quot;running&quot;,</span><br><span class="line">            &quot;Running&quot;: true,</span><br><span class="line">            &quot;Paused&quot;: false,</span><br><span class="line">            &quot;Restarting&quot;: false,</span><br><span class="line">            &quot;OOMKilled&quot;: false,</span><br><span class="line">            &quot;Dead&quot;: false,</span><br><span class="line">            &quot;Pid&quot;: 6410,</span><br><span class="line">            &quot;ExitCode&quot;: 0,</span><br><span class="line">            &quot;Error&quot;: &quot;&quot;,</span><br><span class="line">            &quot;StartedAt&quot;: &quot;2021-01-15T02:40:10.818874068Z&quot;,</span><br><span class="line">            &quot;FinishedAt&quot;: &quot;0001-01-01T00:00:00Z&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Image&quot;: &quot;sha256:300e315adb2f96afe5f0b2780b87f28ae95231fe3bdd1e16b9ba606307728f55&quot;,</span><br><span class="line">        &quot;ResolvConfPath&quot;: &quot;/var/lib/docker/containers/72fb134a68bac8eb736b197fe66b3a7ea9cf726eb16609c2ec145f62979bcec8/resolv.conf&quot;,</span><br><span class="line">        &quot;HostnamePath&quot;: &quot;/var/lib/docker/containers/72fb134a68bac8eb736b197fe66b3a7ea9cf726eb16609c2ec145f62979bcec8/hostname&quot;,</span><br><span class="line">        &quot;HostsPath&quot;: &quot;/var/lib/docker/containers/72fb134a68bac8eb736b197fe66b3a7ea9cf726eb16609c2ec145f62979bcec8/hosts&quot;,</span><br><span class="line">        &quot;LogPath&quot;: &quot;/var/lib/docker/containers/72fb134a68bac8eb736b197fe66b3a7ea9cf726eb16609c2ec145f62979bcec8/72fb134a68bac8eb736b197fe66b3a7ea9cf726eb16609c2ec145f62979bcec8-json.log&quot;,</span><br><span class="line">        &quot;Name&quot;: &quot;/infallible_leavitt&quot;,</span><br><span class="line">        &quot;RestartCount&quot;: 0,</span><br><span class="line">        &quot;Driver&quot;: &quot;aufs&quot;,</span><br><span class="line">        &quot;Platform&quot;: &quot;linux&quot;,</span><br><span class="line">        &quot;MountLabel&quot;: &quot;&quot;,</span><br><span class="line">        &quot;ProcessLabel&quot;: &quot;&quot;,</span><br><span class="line">        &quot;AppArmorProfile&quot;: &quot;docker-default&quot;,</span><br><span class="line">        &quot;ExecIDs&quot;: null,</span><br><span class="line">        &quot;HostConfig&quot;: &#123;</span><br><span class="line">            &quot;Binds&quot;: null,</span><br><span class="line">            &quot;ContainerIDFile&quot;: &quot;&quot;,</span><br><span class="line">            &quot;LogConfig&quot;: &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;json-file&quot;,</span><br><span class="line">                &quot;Config&quot;: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;NetworkMode&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;PortBindings&quot;: &#123;&#125;,</span><br><span class="line">            &quot;RestartPolicy&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;no&quot;,</span><br><span class="line">                &quot;MaximumRetryCount&quot;: 0</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;AutoRemove&quot;: false,</span><br><span class="line">            &quot;VolumeDriver&quot;: &quot;&quot;,</span><br><span class="line">            &quot;VolumesFrom&quot;: null,</span><br><span class="line">            &quot;CapAdd&quot;: null,</span><br><span class="line">            &quot;CapDrop&quot;: null,</span><br><span class="line">            &quot;CgroupnsMode&quot;: &quot;host&quot;,</span><br><span class="line">            &quot;Dns&quot;: [],</span><br><span class="line">            &quot;DnsOptions&quot;: [],</span><br><span class="line">            &quot;DnsSearch&quot;: [],</span><br><span class="line">            &quot;ExtraHosts&quot;: null,</span><br><span class="line">            &quot;GroupAdd&quot;: null,</span><br><span class="line">            &quot;IpcMode&quot;: &quot;private&quot;,</span><br><span class="line">            &quot;Cgroup&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Links&quot;: null,</span><br><span class="line">            &quot;OomScoreAdj&quot;: 0,</span><br><span class="line">            &quot;PidMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Privileged&quot;: false,</span><br><span class="line">            &quot;PublishAllPorts&quot;: false,</span><br><span class="line">            &quot;ReadonlyRootfs&quot;: false,</span><br><span class="line">            &quot;SecurityOpt&quot;: null,</span><br><span class="line">            &quot;UTSMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;UsernsMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;ShmSize&quot;: 67108864,</span><br><span class="line">            &quot;Runtime&quot;: &quot;runc&quot;,</span><br><span class="line">            &quot;ConsoleSize&quot;: [</span><br><span class="line">                0,</span><br><span class="line">                0</span><br><span class="line">            ],</span><br><span class="line">            &quot;Isolation&quot;: &quot;&quot;,</span><br><span class="line">            &quot;CpuShares&quot;: 0,</span><br><span class="line">            &quot;Memory&quot;: 0,</span><br><span class="line">            &quot;NanoCpus&quot;: 0,</span><br><span class="line">            &quot;CgroupParent&quot;: &quot;&quot;,</span><br><span class="line">            &quot;BlkioWeight&quot;: 0,</span><br><span class="line">            &quot;BlkioWeightDevice&quot;: [],</span><br><span class="line">            &quot;BlkioDeviceReadBps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceWriteBps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceReadIOps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceWriteIOps&quot;: null,</span><br><span class="line">            &quot;CpuPeriod&quot;: 0,</span><br><span class="line">            &quot;CpuQuota&quot;: 0,</span><br><span class="line">            &quot;CpuRealtimePeriod&quot;: 0,</span><br><span class="line">            &quot;CpuRealtimeRuntime&quot;: 0,</span><br><span class="line">            &quot;CpusetCpus&quot;: &quot;&quot;,</span><br><span class="line">            &quot;CpusetMems&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Devices&quot;: [],</span><br><span class="line">            &quot;DeviceCgroupRules&quot;: null,</span><br><span class="line">            &quot;DeviceRequests&quot;: null,</span><br><span class="line">            &quot;KernelMemory&quot;: 0,</span><br><span class="line">            &quot;KernelMemoryTCP&quot;: 0,</span><br><span class="line">            &quot;MemoryReservation&quot;: 0,</span><br><span class="line">            &quot;MemorySwap&quot;: 0,</span><br><span class="line">            &quot;MemorySwappiness&quot;: null,</span><br><span class="line">            &quot;OomKillDisable&quot;: false,</span><br><span class="line">            &quot;PidsLimit&quot;: null,</span><br><span class="line">            &quot;Ulimits&quot;: null,</span><br><span class="line">            &quot;CpuCount&quot;: 0,</span><br><span class="line">            &quot;CpuPercent&quot;: 0,</span><br><span class="line">            &quot;IOMaximumIOps&quot;: 0,</span><br><span class="line">            &quot;IOMaximumBandwidth&quot;: 0,</span><br><span class="line">            &quot;MaskedPaths&quot;: [</span><br><span class="line">                &quot;/proc/asound&quot;,</span><br><span class="line">                &quot;/proc/acpi&quot;,</span><br><span class="line">                &quot;/proc/kcore&quot;,</span><br><span class="line">                &quot;/proc/keys&quot;,</span><br><span class="line">                &quot;/proc/latency_stats&quot;,</span><br><span class="line">                &quot;/proc/timer_list&quot;,</span><br><span class="line">                &quot;/proc/timer_stats&quot;,</span><br><span class="line">                &quot;/proc/sched_debug&quot;,</span><br><span class="line">                &quot;/proc/scsi&quot;,</span><br><span class="line">                &quot;/sys/firmware&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;ReadonlyPaths&quot;: [</span><br><span class="line">                &quot;/proc/bus&quot;,</span><br><span class="line">                &quot;/proc/fs&quot;,</span><br><span class="line">                &quot;/proc/irq&quot;,</span><br><span class="line">                &quot;/proc/sys&quot;,</span><br><span class="line">                &quot;/proc/sysrq-trigger&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;GraphDriver&quot;: &#123;</span><br><span class="line">            &quot;Data&quot;: null,</span><br><span class="line">            &quot;Name&quot;: &quot;aufs&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Mounts&quot;: [],</span><br><span class="line">        &quot;Config&quot;: &#123;</span><br><span class="line">            &quot;Hostname&quot;: &quot;72fb134a68ba&quot;,</span><br><span class="line">            &quot;Domainname&quot;: &quot;&quot;,</span><br><span class="line">            &quot;User&quot;: &quot;&quot;,</span><br><span class="line">            &quot;AttachStdin&quot;: false,</span><br><span class="line">            &quot;AttachStdout&quot;: false,</span><br><span class="line">            &quot;AttachStderr&quot;: false,</span><br><span class="line">            &quot;Tty&quot;: false,</span><br><span class="line">            &quot;OpenStdin&quot;: false,</span><br><span class="line">            &quot;StdinOnce&quot;: false,</span><br><span class="line">            &quot;Env&quot;: [</span><br><span class="line">                &quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Cmd&quot;: [</span><br><span class="line">                &quot;/bin/sh&quot;,</span><br><span class="line">                &quot;-c&quot;,</span><br><span class="line">                &quot;while true;do echo hello;sleep 1;done&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Image&quot;: &quot;centos&quot;,</span><br><span class="line">            &quot;Volumes&quot;: null,</span><br><span class="line">            &quot;WorkingDir&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Entrypoint&quot;: null,</span><br><span class="line">            &quot;OnBuild&quot;: null,</span><br><span class="line">            &quot;Labels&quot;: &#123;</span><br><span class="line">                &quot;org.label-schema.build-date&quot;: &quot;20201204&quot;,</span><br><span class="line">                &quot;org.label-schema.license&quot;: &quot;GPLv2&quot;,</span><br><span class="line">                &quot;org.label-schema.name&quot;: &quot;CentOS Base Image&quot;,</span><br><span class="line">                &quot;org.label-schema.schema-version&quot;: &quot;1.0&quot;,</span><br><span class="line">                &quot;org.label-schema.vendor&quot;: &quot;CentOS&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;NetworkSettings&quot;: &#123;</span><br><span class="line">            &quot;Bridge&quot;: &quot;&quot;,</span><br><span class="line">            &quot;SandboxID&quot;: &quot;34fbedfa828ce9ac24fe2c8d41ec73681f086f590c4ef5bc0127148003f15092&quot;,</span><br><span class="line">            &quot;HairpinMode&quot;: false,</span><br><span class="line">            &quot;LinkLocalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">            &quot;LinkLocalIPv6PrefixLen&quot;: 0,</span><br><span class="line">            &quot;Ports&quot;: &#123;&#125;,</span><br><span class="line">            &quot;SandboxKey&quot;: &quot;/var/run/docker/netns/34fbedfa828c&quot;,</span><br><span class="line">            &quot;SecondaryIPAddresses&quot;: null,</span><br><span class="line">            &quot;SecondaryIPv6Addresses&quot;: null,</span><br><span class="line">            &quot;EndpointID&quot;: &quot;8b598080603bf2e297b16e289ef3522f28ef1daa6e85a6022cd6f64ce4e6134c&quot;,</span><br><span class="line">            &quot;Gateway&quot;: &quot;172.17.0.1&quot;,</span><br><span class="line">            &quot;GlobalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">            &quot;GlobalIPv6PrefixLen&quot;: 0,</span><br><span class="line">            &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,</span><br><span class="line">            &quot;IPPrefixLen&quot;: 16,</span><br><span class="line">            &quot;IPv6Gateway&quot;: &quot;&quot;,</span><br><span class="line">            &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,</span><br><span class="line">            &quot;Networks&quot;: &#123;</span><br><span class="line">                &quot;bridge&quot;: &#123;</span><br><span class="line">                    &quot;IPAMConfig&quot;: null,</span><br><span class="line">                    &quot;Links&quot;: null,</span><br><span class="line">                    &quot;Aliases&quot;: null,</span><br><span class="line">                    &quot;NetworkID&quot;: &quot;a7c143d2017571c269a0fb6a526fdfd7415b995f6754bbae853ad33830adb693&quot;,</span><br><span class="line">                    &quot;EndpointID&quot;: &quot;8b598080603bf2e297b16e289ef3522f28ef1daa6e85a6022cd6f64ce4e6134c&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;172.17.0.1&quot;,</span><br><span class="line">                    &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,</span><br><span class="line">                    &quot;IPPrefixLen&quot;: 16,</span><br><span class="line">                    &quot;IPv6Gateway&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;GlobalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;GlobalIPv6PrefixLen&quot;: 0,</span><br><span class="line">                    &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,</span><br><span class="line">                    &quot;DriverOpts&quot;: null</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p><strong>进入当前正在运行的容器</strong></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># 通常容器都是使用后台方式运行的，需要进入容器，修改一些配置</span><br><span class="line"></span><br><span class="line"># 命令</span><br><span class="line">docker exec -it 容器id BashShell</span><br><span class="line"></span><br><span class="line"># 测试</span><br><span class="line">grx@ubuntu:~$ docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS         PORTS     NAMES</span><br><span class="line">72fb134a68ba   centos    &quot;/bin/sh -c &#x27;while t…&quot;   8 minutes ago   Up 8 minutes             infallible_leavitt</span><br><span class="line">grx@ubuntu:~$ docker exec -it 72fb134a68ba /bin/bash</span><br><span class="line">[root@72fb134a68ba /]# ls</span><br><span class="line">bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line">[root@72fb134a68ba /]# ps -ef</span><br><span class="line">UID         PID   PPID  C STIME TTY          TIME CMD</span><br><span class="line">root          1      0  0 02:40 ?        00:00:00 /bin/sh -c while true;do echo hello;sleep 1;done</span><br><span class="line">root        546      0  0 02:49 pts/0    00:00:00 /bin/bash</span><br><span class="line">root        564      1  0 02:49 ?        00:00:00 /usr/bin/coreutils --coreutils-prog-shebang=sleep /usr/bin/sleep 1</span><br><span class="line">root        565    546  0 02:49 pts/0    00:00:00 ps -ef</span><br><span class="line"></span><br><span class="line"># 方式二</span><br><span class="line">docker attach 容器id</span><br><span class="line"># 测试</span><br><span class="line">grx@ubuntu:~$ docker attach 72fb134a68ba</span><br><span class="line">正在执行当前的代码...</span><br><span class="line"></span><br><span class="line"># docker exec       # 进入容器后开启一个新的终端，可以在里面操作（常用）</span><br><span class="line"># docker attach     # 进入容器后正在执行的终端，不会启动新的进程！</span><br></pre></td></tr></table></figure>

<p><strong>从容器内拷贝文件到主机上</strong></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">docker cp 容器id:容器内路径 目的主机路径</span><br><span class="line"></span><br><span class="line"># 在容器内部创建文件</span><br><span class="line">grx@ubuntu:~$ docker run -it centos /bin/bash</span><br><span class="line">[root@d7b4b1d66e10 /]# cd home/</span><br><span class="line">[root@d7b4b1d66e10 home]# ls</span><br><span class="line">[root@d7b4b1d66e10 home]# touch test.java</span><br><span class="line">[root@d7b4b1d66e10 home]# ls</span><br><span class="line">test.java</span><br><span class="line"></span><br><span class="line"># 拷贝到宿主机</span><br><span class="line">grx@ubuntu:~$ docker cp d7b4b1d66e10:/home/test.java /home</span><br><span class="line">open /home/test.java: permission denied</span><br><span class="line"># 可能需要sudo权限</span><br><span class="line">grx@ubuntu:~$ sudo docker cp d7b4b1d66e10:/home/test.java /home</span><br><span class="line">[sudo] password for grx:</span><br><span class="line">grx@ubuntu:~$ cd /home/</span><br><span class="line">grx@ubuntu:/home$ ls</span><br><span class="line">grx  test.java</span><br><span class="line"></span><br><span class="line"># 拷贝是一个手动过程，未来我们使用-v数据卷的技术，可以实现</span><br></pre></td></tr></table></figure>

<h3 id="5-小结"><a href="#5-小结" class="headerlink" title="5. 小结"></a>5. 小结</h3><p><img src="/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-b07ce47f21897e58cf9e0682ba8fdaf1_1440w.webp" alt="img"></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">attach      Attach local standard input, output, and error streams to a running container   # 当前shell下attach连接指定运行镜像</span><br><span class="line">build       Build an image from a Dockerfile        # 通过Dockerfile定制镜像</span><br><span class="line">commit      Create a new image from a container&#x27;s changes       # 提交当前容器为新的镜像</span><br><span class="line">cp          Copy files/folders between a container and the local filesystem # 从容器中拷贝指定文件或者目录到宿主机中</span><br><span class="line">create      Create a new container  # 创建一个新的容器，同run，但不启动容器</span><br><span class="line">diff        Inspect changes to files or directories on a container&#x27;s filesystem # 查看docker容器变化</span><br><span class="line">events      Get real time events from the server    # 从docker服务获取容器实时事件</span><br><span class="line">exec        Run a command in a running container    # 在已存在的容器上运行命令</span><br><span class="line">export      Export a container&#x27;s filesystem as a tar archive    # 导出容器的内容作为一个tar归档文件[对应import]</span><br><span class="line">history     Show the history of an image    # 显示一个镜像形成历史</span><br><span class="line">images      List images     # 列出系统当前镜像</span><br><span class="line">import      Import the contents from a tarball to create a filesystem image     # 从tar包中的内容创建一个新的文件系统映像[对应export]</span><br><span class="line">info        Display system-wide information     # 显示系统相关信息</span><br><span class="line">inspect     Return low-level information on Docker objects      # 查看容器详细信息</span><br><span class="line">kill        Kill one or more running containers     # kill指定docker容器</span><br><span class="line">load        Load an image from a tar archive or STDIN   # 从一个tar包中加载一个镜像[对应save]</span><br><span class="line">login       Log in to a Docker registry     # 注册或者登录一个docker源服务器</span><br><span class="line">logout      Log out from a Docker registry  # 从当前Docker registry退出</span><br><span class="line">logs        Fetch the logs of a container   # 输出当前容器日志信息</span><br><span class="line">pause       Pause all processes within one or more containers   # 暂停容器</span><br><span class="line">port        List port mappings or a specific mapping for the container  # 查看映射端口对应的容器内部源端口</span><br><span class="line">ps          List containers     # 列出容器列表</span><br><span class="line">pull        Pull an image or a repository from a registry   # 从docker镜像源服务器拉取指定镜像或者库镜像</span><br><span class="line">push        Push an image or a repository to a registry     # 推送指定镜像或库镜像至docker源服务器</span><br><span class="line">rename      Rename a container  # 重命名容器</span><br><span class="line">restart     Restart one or more containers  # 重启运行的容器</span><br><span class="line">rm          Remove one or more containers   # 移除一个或者多个容器</span><br><span class="line">rmi         Remove one or more images       # 移除一个或者多个镜像【无容器使用该镜像才可删除，否则需要删除相关容器才可继续或者-f强制删除】</span><br><span class="line">run         Run a command in a new container    # 创建一个新的容器并运行一个命令</span><br><span class="line">save        Save one or more images to a tar archive (streamed to STDOUT by default)    # 保存一个镜像为一个tar包【对应load】</span><br><span class="line">search      Search the Docker Hub for images    # 在docker hub中搜索镜像</span><br><span class="line">start       Start one or more stopped containers    # 启动容器</span><br><span class="line">stop        Stop one or more running containers     # 停止容器</span><br><span class="line">tag         Create a tag TARGET_IMAGE that refers to SOURCE_IMAGE # 给源中镜像打标签</span><br><span class="line">top         Display the running processes of a container    # 查看容器中运行的进程信息</span><br><span class="line">unpause     Unpause all processes within one or more containers # 取消暂停容器</span><br><span class="line">update      Update configuration of one or more containers  # 更新一个或多个容器配置</span><br><span class="line">version     Show the Docker version information     # 查看docker版本号</span><br><span class="line">wait        Block until one or more containers stop, then print their exit codes    # 截取容器停止时的退出状态值</span><br></pre></td></tr></table></figure>

<h3 id="6-作业练习"><a href="#6-作业练习" class="headerlink" title="6. 作业练习"></a>6. 作业练习</h3><blockquote>
<p>Docker安装Nginx</p>
</blockquote>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># 1. 搜索镜像 docker search，推荐去dockerhub搜索，可以看到帮助文档</span><br><span class="line"># 2. 下载镜像 docker pull</span><br><span class="line"># 3. 运行测试</span><br><span class="line">grx@ubuntu:~$ docker images</span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">nginx         latest    f6d0b4767a6c   2 days ago      133MB</span><br><span class="line"></span><br><span class="line"># -d 后台运行</span><br><span class="line"># --name 给容器命名</span><br><span class="line"># -p 宿主机端口:容器内部端口</span><br><span class="line">grx@ubuntu:~$ docker run -d --name nginx01 -p 3340:80 nginx</span><br><span class="line">d4b569e42439896f2ddf15b9c12c7840d9b161361d752b8ab1e4d3a1117238b9</span><br><span class="line">grx@ubuntu:~$ docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS         PORTS                  NAMES</span><br><span class="line">d4b569e42439   nginx     &quot;/docker-entrypoint.…&quot;   5 seconds ago   Up 4 seconds   0.0.0.0:3340-&gt;80/tcp   nginx01</span><br><span class="line">grx@ubuntu:~$ curl localhost:3340</span><br><span class="line"></span><br><span class="line"># 进入容器</span><br><span class="line">grx@ubuntu:~$ docker exec -it nginx01 /bin/bash</span><br><span class="line">root@d4b569e42439:/# whereis nginx</span><br><span class="line">nginx: /usr/sbin/nginx /usr/lib/nginx /etc/nginx /usr/share/nginx</span><br><span class="line">root@d4b569e42439:/# ls /etc/nginx</span><br><span class="line">conf.d          koi-utf  mime.types  nginx.conf   uwsgi_params</span><br><span class="line">fastcgi_params  koi-win  modules     scgi_params  win-utf</span><br></pre></td></tr></table></figure>

<p>端口暴露的概念</p>
<p><img src="/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-7c06cb1438a628010da98dcda94bc36d_1440w.webp" alt="img"></p>
<p>思考问题：我们每次改动nginx配置文件，都需要进入容器内部？十分的麻烦，要是可以在容器外部提供一个映射路径，达到在容器修改文件名，容器内部就可以自动修改？-v 数据卷</p>
<blockquote>
<p>Docker安装Tomcat</p>
</blockquote>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 官方的使用</span><br><span class="line">docker run -it -rm tomcat:9.0</span><br><span class="line"></span><br><span class="line"># 我们之前的启动都是后台，停止了容器之后，容器还是可以查到  docker run -it --rm，一般用来测试，用完就删除</span><br><span class="line"></span><br><span class="line"># 下载再启动</span><br><span class="line">grx@ubuntu:~$ docker run -d -p 3355:8080 --name tomcat01 tomcat</span><br><span class="line"></span><br><span class="line"># 测试访问没有问题</span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-704566e16590938d7df11d17b82eb054_1440w.webp" alt="img"></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 进入容器</span><br><span class="line">grx@ubuntu:~$ docker exec -it tomcat01 /bin/bash</span><br><span class="line"></span><br><span class="line"># 发现问题：1、linux命令少了；2、没有webapps。阿里云镜像的原因，默认是最小的镜像，所有不必要的都剔除掉。</span><br><span class="line"># 保证最小可运行的环境！</span><br><span class="line"></span><br><span class="line">root@00c0a8b4017f:/usr/local/tomcat# ls</span><br><span class="line">BUILDING.txt     NOTICE         RUNNING.txt  lib             temp          work</span><br><span class="line">CONTRIBUTING.md  README.md      bin          logs            webapps</span><br><span class="line">LICENSE          RELEASE-NOTES  conf         native-jni-lib  webapps.dist</span><br><span class="line">root@00c0a8b4017f:/usr/local/tomcat# rm -rf webapps</span><br><span class="line">root@00c0a8b4017f:/usr/local/tomcat# mv webapps.dist/ webapps</span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-88b296c6fd3ef5eb2cfe0f320524db97_1440w.webp" alt="img"></p>
<p>思考问题：我们以后要部署项目，如果每次都要进入容器是不是十分麻烦？要是可以在容器外部提供一个映射路径，webapps，在外部放置项目，自动同步到内部？</p>
<h3 id="7-可视化"><a href="#7-可视化" class="headerlink" title="7. 可视化"></a>7. 可视化</h3><ul>
<li>portainer（先用这个）</li>
<li>Rancher（CI&#x2F;CD再用）</li>
</ul>
<p><strong>什么是portainer？</strong></p>
<p>Docker图形化界面管理工具！提供一个后台面板供我们操作！</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 8088:9000 \</span><br><span class="line">--restart=always -v /var/run/docker.sock:/var/run/docker.sock --privileged=true portainer/portainer</span><br></pre></td></tr></table></figure>

<p>访问测试：</p>
<p><img src="/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-928ff6d8c5f3b023f89b2819eebc4fd6_1440w.webp" alt="img"></p>
<p>选择本地：</p>
<p><img src="/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-08f4414acc50b8d043b3c5b23317b3e9_1440w.webp" alt="img"></p>
<p>进入之后的面板：</p>
<p><img src="/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-3c0bfb6e1bf289d42f65ad6d216f7f77_1440w.webp" alt="img"></p>
<h3 id="四、Docker镜像讲解"><a href="#四、Docker镜像讲解" class="headerlink" title="四、Docker镜像讲解"></a>四、Docker镜像讲解</h3><h3 id="1-镜像是什么"><a href="#1-镜像是什么" class="headerlink" title="1. 镜像是什么"></a>1. 镜像是什么</h3><p>镜像是一种轻量级、可执行的独立软件包，用来打包软件运行环境和基于运行环境开发的软件，它包含运行某个软件所需的所有内容，包括代码、运行时的库、环境变量和配置文件。</p>
<p>所有的应用，直接打包Docker镜像，就可以直接跑起来！</p>
<p>如何得到镜像：</p>
<ul>
<li>从远程仓库下载</li>
<li>通过DockerFile制作</li>
</ul>
<h3 id="2-镜像加载原理"><a href="#2-镜像加载原理" class="headerlink" title="2. 镜像加载原理"></a>2. 镜像加载原理</h3><blockquote>
<p>UnionFS（联合文件系统）</p>
</blockquote>
<p>UnionFS（联合文件系统）：Union文件系统（UnionFS）是一种分层、轻量级并且高性能的文件系统，它支持对文件系统的修改作为一次提交来一层层的叠加，同时可以将不同目录挂载到一个虚拟文件系统下（unite several directories into a single virtual file system）。Union文件系统是Docker镜像的基础，镜像可以通过分层来进行继承，基于基础镜像（没有父镜像），可以制作各种具体的应用镜像。</p>
<p>特性：一次同时加载多个文件系统，但从外面看起来，只能看到一个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文件系统会包含所有底层的文件和目录。</p>
<blockquote>
<p>Docker镜像加载原理</p>
</blockquote>
<p>Docker的镜像实际上由一层一层的文件系统组成，这种层级的文件系统称为UnionFS。</p>
<p>bootfs（boot file system）主要包含BootLoader和kernel，BootLoader主要是引导加载kernel，linux刚启动时会加载bootfs文件系统，在Docker镜像的最底层是bootfs。这一层与我们典型的linux&#x2F;unix系统是一样的，包含boot加载器和内核。当boot加载完成之后，整个内核就都在内存中了，此时内存的使用权已由bootfs转交给内核，此时系统也会卸载bootfs。</p>
<p>rootfs（root file system），在bootfs之上。包含的就是典型linux系统中的&#x2F;dev,&#x2F;proc,&#x2F;bin,&#x2F;etc等标准目录和文件。rootfs就是各种不同的操作系统发行版，比如Ubuntu，CentOS等。</p>
<p><img src="/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-80c0164f0655d33dc83b1b6281e5a95a_1440w.webp" alt="img"></p>
<p>平时我们安装进虚拟机的CentOS都是好几个G，为什么Docker这里才200M？</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">grx@ubuntu:~$ docker images</span><br><span class="line">REPOSITORY            TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">centos                latest    300e315adb2f   6 weeks ago     209MB</span><br></pre></td></tr></table></figure>

<p>对于一个精简的OS，rootfs可以很小，只需要包含最基本的命令、工具和程序库就可以了，因为底层直接用host的kernel，自己只需要提供rootfs就可以了。由此可见对于不同的linux发行版，bootfs基本是一致的，rootfs会有差别，因此不同的发行版可以共用bootfs。</p>
<p>启动虚拟机是分钟级别，容器是秒级！</p>
<h3 id="3-分层理解"><a href="#3-分层理解" class="headerlink" title="3. 分层理解"></a>3. 分层理解</h3><blockquote>
<p>分层的镜像</p>
</blockquote>
<p>我们可以去下载一个镜像，注意观察下载的日志输出，可以看到是一层一层的在下</p>
<p>思考：为什么Docker镜像要采用这种分层的结构呢？</p>
<p>最大的好处莫过于资源共享！比如有多个镜像都从相同的base镜像构建而来，那么宿主机只需在磁盘上保留一份base镜像，同时内存中也只需要加载一份base镜像，这样就可以为所有的容器服务了，而且镜像的每一层都可以被共享。</p>
<p>查看镜像分层的方式可以通过docker image inspect命令！</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">grx@ubuntu:~$ docker image inspect redis:latest</span><br><span class="line">[</span><br><span class="line">    // ...</span><br><span class="line">    &quot;RootFS&quot;: &#123;</span><br><span class="line">            &quot;Type&quot;: &quot;layers&quot;,</span><br><span class="line">            &quot;Layers&quot;: [</span><br><span class="line">                &quot;sha256:cb42413394c4059335228c137fe884ff3ab8946a014014309676c25e3ac86864&quot;,</span><br><span class="line">                &quot;sha256:8e14cb7841faede6e42ab797f915c329c22f3b39026f8338c4c75de26e5d4e82&quot;,</span><br><span class="line">                &quot;sha256:1450b8f0019c829e638ab5c1f3c2674d117517669e41dd2d0409a668e0807e96&quot;,</span><br><span class="line">                &quot;sha256:f927192cc30cb53065dc266f78ff12dc06651d6eb84088e82be2d98ac47d42a0&quot;,</span><br><span class="line">                &quot;sha256:a24a292d018421783c491bc72f6601908cb844b17427bac92f0a22f5fd809665&quot;,</span><br><span class="line">                &quot;sha256:3480f9cdd491225670e9899786128ffe47054b0a5d54c48f6b10623d2f340632&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Metadata&quot;: &#123;</span><br><span class="line">            &quot;LastTagTime&quot;: &quot;0001-01-01T00:00:00Z&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>所有的Docker镜像都起始于一个基础镜像层，当进行修改或增加新的内容时，就会在当前镜像层之上，创建新的镜像层。</p>
<p>举一个简单的例子，假如基于Ubuntu Linux 16.04创建一个新的镜像，这就是新镜像的第一层；如果在该镜像中添加Python包，就会在基础镜像层之上创建第二个镜像层；如果继续添加一个安全补丁，就会创建第三个镜像层。</p>
<p>该镜像当前已经包含3个镜像层，如下图所示（这只是一个用于演示的很简单的例子）。</p>
<p><img src="/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-2a8feb14f02b36352bbd4a5ea2d87aab_1440w.webp" alt="img"></p>
<p>在添加额外的镜像层的同时，镜像始终保持是当前所有镜像的组合，理解这一点非常重要。下图举了一个简单的例子，每个镜像层包含三个文件，而镜像包含了来自两个镜像层的6个文件。</p>
<p><img src="/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-559a93cdb70a070195ac25744342307a_1440w.webp" alt="img"></p>
<p>上图中的镜像层跟之前图中的略有区别，主要目的是便于展示文件。 下图中示了一个稍微复杂的三层镜像，在外部看来整个镜像只有6个文件，这是因为最上层中的文件7是文件5的一个更新版本。</p>
<p><img src="/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-737889c9bf3f917a73b156885abcf5e8_1440w.webp" alt="img"></p>
<p>这种情况下，上层镜像层中的文件覆盖了底层镜像层中的文件。这样就使得文件的更新版本作为一个新镜像层添加到镜像当中。</p>
<p>Docker通过存储引擎（新版本采用快照机制）的方式来实现镜像层堆栈，并保证多镜像层对外展示为统一的文件系统。</p>
<p>Linux上可用的存储引擎有AUFS、Overlay2、 Device Mapper、Btrfs 以及ZFS。顾名思义，每种存储引擎都基于Linux中对应的文件系统或者块设备技术，并且每种存储引擎都有其独有的性能特点。</p>
<p>Docker在Windows上仅支持windowsfilter 一种存储引擎，该引擎基于NTFS文件系统之上实现了分层和CoW[1]。</p>
<p>下图展示了与系统显示相同的三层镜像。所有镜像层堆叠并合并，对外提供统一的视图。</p>
<p><img src="/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-0a414b3fe77d3c9365f32a10d5a92851_1440w.webp" alt="img"></p>
<blockquote>
<p>特点</p>
</blockquote>
<p>Docker镜像是只读的，当容器启动时，一个新的可写层被加载到镜像顶部！</p>
<p>这一层就是我们通常说的容器层，容器之下的都叫镜像层！</p>
<p><img src="/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-2d3dcf671aabc592f8a427175a888c51_1440w.webp" alt="img"></p>
<h3 id="4-commit镜像"><a href="#4-commit镜像" class="headerlink" title="4. commit镜像"></a>4. commit镜像</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker commit 提交容器成为一个新的副本</span><br><span class="line"></span><br><span class="line">docker commit -m=&quot;提交的描述信息&quot; -a=&quot;作者&quot; 容器ID 目标镜像名:[TAG]</span><br></pre></td></tr></table></figure>

<p>实战测试</p>
<ul>
<li>启动一个默认的tomcat</li>
</ul>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grx@ubuntu:~$ docker run -d -p 8080:8080 tomcat</span><br></pre></td></tr></table></figure>

<ul>
<li>进入容器</li>
</ul>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grx@ubuntu:~$ docker exec -it fa1b4fef61c9 /bin/bash</span><br></pre></td></tr></table></figure>

<ul>
<li>发现这个默认的tomcat 里面webapps什么都没有</li>
</ul>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@fa1b4fef61c9:/usr/local/tomcat# ls webapps</span><br><span class="line">root@fa1b4fef61c9:/usr/local/tomcat#</span><br></pre></td></tr></table></figure>

<ul>
<li>从webapp.dist中拷贝出所有目录到webapps目录下</li>
</ul>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@fa1b4fef61c9:/usr/local/tomcat# cp -r webapps.dist/* webapps</span><br></pre></td></tr></table></figure>

<ul>
<li>将我们操作过的容器通过commit提交为一个镜像</li>
</ul>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">grx@ubuntu:~$ docker commit -a=&quot;grx&quot; -m=&quot;add webapps&quot; fa1b4fef61c9 tomcat-grx</span><br><span class="line">sha256:87aa7ed119c272f625650859cdb1723cc49ea113b2f86f18a936ee4234526eae</span><br><span class="line">grx@ubuntu:~$ docker images</span><br><span class="line">REPOSITORY            TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">tomcat-grx            latest    87aa7ed119c2   8 seconds ago   653MB</span><br><span class="line">tomcat                latest    040bdb29ab37   8 days ago      649MB</span><br></pre></td></tr></table></figure>

<p>如果想要保存当前容器的状态，可以通过commit来提交，获得一个镜像。</p>
<h3 id="五、容器数据卷"><a href="#五、容器数据卷" class="headerlink" title="五、容器数据卷"></a>五、容器数据卷</h3><h3 id="1-什么是容器数据卷"><a href="#1-什么是容器数据卷" class="headerlink" title="1. 什么是容器数据卷"></a>1. 什么是容器数据卷</h3><p><strong>Docker的理念回顾</strong></p>
<p>将应用和环境打包成一个镜像！</p>
<p>如果数据都存在容器中，那么我把容器删除，所有的数据将全部丢失！需求：数据可以持久化</p>
<p>如：MySQL数据可以存储在本地！</p>
<p>容器之间可以有一个数据共享技术，Docker容器产生的数据同步到本地！</p>
<p>这就是卷技术！目录的挂载，将我们容器的目录挂载到Linux上面！</p>
<p><img src="/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-62f6ac59bb63d786951795d064df26f3_1440w.webp" alt="img"></p>
<p><strong>总结：容器的持久化和同步操作！容器间也是可以数据共享的</strong></p>
<h3 id="2-使用数据卷"><a href="#2-使用数据卷" class="headerlink" title="2. 使用数据卷"></a>2. 使用数据卷</h3><blockquote>
<p>方式一：直接使用命令来挂载</p>
</blockquote>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -v 主机目录:容器内目录</span><br><span class="line"></span><br><span class="line"># 测试</span><br><span class="line">grx@ubuntu:~$ docker run -it -v /home/ceshi:/home centos /bin/bash</span><br><span class="line"># 启动起来后通过docker inspect 容器ID 查看</span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-06741390ee09857de8603dd1f26c9dcb_1440w.webp" alt="img"></p>
<p>测试文件的同步：</p>
<p>容器内修改文件，同步到宿主机：</p>
<p><img src="/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-c10e578a91dfb416d40bebdfa77bd473_1440w.webp" alt="img"></p>
<p>宿主机修改文件，同步到容器：</p>
<p><img src="/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-c99cfb9af0aa00c82d96e9b8c0eee2fb_1440w.webp" alt="img"></p>
<p>好处：我们以后修改只需要在本地修改即可，容器内会自动同步！</p>
<h3 id="3-实战：MySQL同步数据"><a href="#3-实战：MySQL同步数据" class="headerlink" title="3. 实战：MySQL同步数据"></a>3. 实战：MySQL同步数据</h3><p>思考：MySQL的数据持久化问题？</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 获取镜像</span><br><span class="line">grx@ubuntu:~$ docker pull mysql:5.7</span><br><span class="line"></span><br><span class="line"># 运行容器，需要做数据挂载！</span><br><span class="line"># 安装启动mysql，需要配置密码！</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 启动</span><br><span class="line">-d 后台启动 </span><br><span class="line">-p 端口映射</span><br><span class="line">-v 卷挂载</span><br><span class="line">-e 环境配置</span><br><span class="line">grx@ubuntu:~$ docker run -d -p 3310:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql01 mysql:5.7</span><br></pre></td></tr></table></figure>

<p>测试数据是否同步到本地：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 容器中创建数据库</span><br><span class="line">create database testdb;</span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-8bddf8c86c2666516ec5824acc504965_1440w.webp" alt="img"></p>
<p>假设我们将容器删除，</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">grx@ubuntu:/home/mysql$ docker ps</span><br><span class="line">CONTAINER ID   IMAGE                 COMMAND                  CREATED          STATUS          PORTS                               NAMES</span><br><span class="line">09810bcf64fe   mysql:5.7             &quot;docker-entrypoint.s…&quot;   5 minutes ago    Up 5 minutes    33060/tcp, 0.0.0.0:3310-&gt;3306/tcp   mysql01</span><br><span class="line">grx@ubuntu:/home/mysql$ docker rm -f 09810bcf64fe</span><br></pre></td></tr></table></figure>

<p>发现我们挂载到本地的数据卷依旧没有丢失，这就实现了容器数据持久化功能！</p>
<h3 id="4-具名挂载和匿名挂载"><a href="#4-具名挂载和匿名挂载" class="headerlink" title="4. 具名挂载和匿名挂载"></a>4. 具名挂载和匿名挂载</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"># 匿名挂载</span><br><span class="line"># -v 只指定了容器内部的地址 没有指定外部的地址</span><br><span class="line">grx@ubuntu:/home/mysql$ docker run -d -P --name nginx01 -v /etc/nginx nginx</span><br><span class="line"></span><br><span class="line">grx@ubuntu:/home/mysql$ docker volume ls</span><br><span class="line">DRIVER    VOLUME NAME</span><br><span class="line">local     00f782981fad793eed023226e7f2ef41867017ac1737ed6f0fe44d2d9120b156</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 具名挂载</span><br><span class="line"># -v 卷名:容器内路径 指定了卷名juming-nginx</span><br><span class="line">grx@ubuntu:/home/mysql$ docker run -d -P --name nginx02 -v jvming-nginx:/etc/nginx nginx</span><br><span class="line"></span><br><span class="line">grx@ubuntu:/home/mysql$ docker volume ls</span><br><span class="line">DRIVER    VOLUME NAME</span><br><span class="line">local     jvming-nginx</span><br><span class="line"># 查看一下这个卷</span><br><span class="line">grx@ubuntu:/home/mysql$ docker volume inspect jvming-nginx</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;CreatedAt&quot;: &quot;2021-01-22T14:08:16+08:00&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Labels&quot;: null,</span><br><span class="line">        &quot;Mountpoint&quot;: &quot;/var/lib/docker/volumes/jvming-nginx/_data&quot;,</span><br><span class="line">        &quot;Name&quot;: &quot;jvming-nginx&quot;,</span><br><span class="line">        &quot;Options&quot;: null,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>所有的Docker容器内的卷，没有指定目录的情况下都是在<code>/var/lib/docker/volumes/xxxxx/_data</code></p>
<p>我们通过具名挂载可以方便的找到我们的一个卷，大多数情况都是用<code>具名挂载</code></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-v 容器内路径                #匿名挂载</span><br><span class="line">-v 卷名:容器内路径             #具名挂载</span><br><span class="line">-v /宿主机路径:容器内路径         #指定路径挂载</span><br></pre></td></tr></table></figure>

<p>拓展：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 通过 -v 容器内路径:ro/rw  改变读写权限</span><br><span class="line">ro          readonly            #只读，只能从宿主机操作</span><br><span class="line">rw          readwrite           #可读可写</span><br><span class="line"></span><br><span class="line">docker run -d -P --name nginx01 -v juming-nginx:/etc/nginx:ro nginx</span><br><span class="line">docker run -d -P --name nginx02 -v juming-nginx:/etc/nginx:rw nginx</span><br></pre></td></tr></table></figure>

<h3 id="5-初识Dockerfile"><a href="#5-初识Dockerfile" class="headerlink" title="5. 初识Dockerfile"></a>5. 初识Dockerfile</h3><p>Dockerfile就是构建docker镜像的构建文件（命令脚本）。</p>
<p>通过这个脚本可以生成镜像，镜像是一层一层的，脚本是一个个的命令，每个命令都是一层。</p>
<p>创建一个Dockerfile文件，文件名建议为Dockerfile。</p>
<p>文件中的内容：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"># 指令（大写） 参数</span><br><span class="line">FROM centos</span><br><span class="line"></span><br><span class="line">VOLUME [&quot;volume01&quot;,&quot;youngj&quot;]</span><br><span class="line"></span><br><span class="line">CMD echo &quot;----end-----&quot;</span><br><span class="line"></span><br><span class="line">CMD /bin/bash</span><br><span class="line"># 这里的每个命令，就是镜像的一层！</span><br><span class="line"># 执行脚本</span><br><span class="line">grx@ubuntu:~/docker-test$ docker build -f Dockerfile -t grx/centos .</span><br><span class="line">Sending build context to Docker daemon  2.048kB</span><br><span class="line">Step 1/4 : FROM centos</span><br><span class="line"> ---&gt; 300e315adb2f</span><br><span class="line">Step 2/4 : VOLUME [&quot;volume01&quot;,&quot;volume02&quot;]</span><br><span class="line"> ---&gt; Running in 569b21d5f74d</span><br><span class="line">Removing intermediate container 569b21d5f74d</span><br><span class="line"> ---&gt; 14f4ddd15f25</span><br><span class="line">Step 3/4 : CMD echo &quot;----end----&quot;</span><br><span class="line"> ---&gt; Running in a51db16ad01b</span><br><span class="line">Removing intermediate container a51db16ad01b</span><br><span class="line"> ---&gt; 6f90fabce05a</span><br><span class="line">Step 4/4 : CMD /bin/bash</span><br><span class="line"> ---&gt; Running in 0f7ce99b75c1</span><br><span class="line">Removing intermediate container 0f7ce99b75c1</span><br><span class="line"> ---&gt; 36f63dfddaac</span><br><span class="line">Successfully built 36f63dfddaac</span><br><span class="line">Successfully tagged grx/centos:latest</span><br><span class="line"></span><br><span class="line"># 查看镜像</span><br><span class="line">grx@ubuntu:~/docker-test$ docker images</span><br><span class="line">REPOSITORY            TAG       IMAGE ID       CREATED          SIZE</span><br><span class="line">grx/centos            latest    36f63dfddaac   11 seconds ago   209MB</span><br><span class="line"></span><br><span class="line"># 启动</span><br><span class="line">grx@ubuntu:~/docker-test$ docker run -it 36f63dfddaac /bin/bash</span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-c9bae135796b9a2e990de9773ddd0a65_1440w.webp" alt="img"></p>
<p>查看一下卷挂载的路径：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">grx@ubuntu:~/docker-test$ docker inspect 0d071b81ab34</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        ...</span><br><span class="line">        &quot;Mounts&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;volume&quot;,</span><br><span class="line">                &quot;Name&quot;: &quot;5f23994e2ffdef890e943152d0dd7d71e0370e128501c83743d3bd36c2a4b398&quot;,</span><br><span class="line">                &quot;Source&quot;: &quot;/var/lib/docker/volumes/5f23994e2ffdef890e943152d0dd7d71e0370e128501c83743d3bd36c2a4b398/_data&quot;,</span><br><span class="line">                &quot;Destination&quot;: &quot;volume02&quot;,</span><br><span class="line">                &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">                &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">                &quot;RW&quot;: true,</span><br><span class="line">                &quot;Propagation&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;volume&quot;,</span><br><span class="line">                &quot;Name&quot;: &quot;1fb27c72ab89873d52f3f0c7cdb935c97fc77c539891b8fd820f5651530f5936&quot;,</span><br><span class="line">                &quot;Source&quot;: &quot;/var/lib/docker/volumes/1fb27c72ab89873d52f3f0c7cdb935c97fc77c539891b8fd820f5651530f5936/_data&quot;,</span><br><span class="line">                &quot;Destination&quot;: &quot;volume01&quot;,</span><br><span class="line">                &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">                &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">                &quot;RW&quot;: true,</span><br><span class="line">                &quot;Propagation&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">            ...</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>测试文件是否同步：</p>
<p>进入volume01文件夹，创建一个contener.txt文件</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@0d071b81ab34 /]# cd volume01/</span><br><span class="line">[root@0d071b81ab34 volume01]# touch container.txt</span><br><span class="line">[root@0d071b81ab34 volume01]# ls</span><br><span class="line">container.txt</span><br></pre></td></tr></table></figure>

<p>进入目录查看文件是否生成成功</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:/var/lib/docker# cd /var/lib/docker/volumes/1fb27c72ab89873d52f3f0c7cdb935c97fc77c539891b8fd820f5651530f5936/_data</span><br><span class="line">root@ubuntu:/var/lib/docker/volumes/1fb27c72ab89873d52f3f0c7cdb935c97fc77c539891b8fd820f5651530f5936/_data# ls</span><br><span class="line">container.txt</span><br></pre></td></tr></table></figure>

<p>这种方式我们未来使用的十分多，因为我们通常会构建自己的镜像！</p>
<p>假设构建镜像的时候没有挂载卷，要手动镜像挂载 -v 卷名:容器内路径！</p>
<h3 id="6-数据卷容器"><a href="#6-数据卷容器" class="headerlink" title="6. 数据卷容器"></a>6. 数据卷容器</h3><p>多个容器共享数据？</p>
<p><img src="/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-8f48654b71c257bedd74d456f8ddf3ea_1440w.webp" alt="img"></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 通过我们自己构建的镜像，启动3个，进行测试。</span><br><span class="line">grx@ubuntu:~$ docker run -it --name docker01 grx/centos</span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-ef784525355a286e40c69a8443e6a481_1440w.webp" alt="img"></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 再启动一个</span><br><span class="line"># --volumes-from 实现了数据同步，相当于继承docker01</span><br><span class="line">grx@ubuntu:~$ docker run -it --name docker02 --volumes-from docker01 grx/centos</span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-141ac11e311b235a6d5858748a39f2cd_1440w.webp" alt="img"></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"># 在docker01容器进入volume01文件夹，创建docker01.txt文件，再去docker02容器查看是否同步成功</span><br><span class="line">grx@ubuntu:~$ docker attach docker01</span><br><span class="line">[root@6f3103cdfacb /]# ls</span><br><span class="line">bin  etc   lib    lost+found  mnt  proc  run   srv  tmp  var       volume02</span><br><span class="line">dev  home  lib64  media       opt  root  sbin  sys  usr  volume01</span><br><span class="line">[root@6f3103cdfacb /]# cd volume01/</span><br><span class="line">[root@6f3103cdfacb volume01]# touch docker01.txt</span><br><span class="line">[root@6f3103cdfacb volume01]# ls</span><br><span class="line">docker01.txt</span><br><span class="line"># 在docker02容器中发现docker01.txt同步成功！</span><br><span class="line">[root@19e8fc7975fe /]# ls volume01/</span><br><span class="line">docker01.txt</span><br><span class="line"># 再新建一个docker03容器</span><br><span class="line">grx@ubuntu:~$ docker run -it --name docker03 --volumes-from docker01 grx/centos</span><br><span class="line">[root@545bede4aeb1 /]# ls</span><br><span class="line">bin  etc   lib    lost+found  mnt  proc  run   srv  tmp  var       volume02</span><br><span class="line">dev  home  lib64  media       opt  root  sbin  sys  usr  volume01</span><br><span class="line">[root@545bede4aeb1 /]# cd volume01/</span><br><span class="line">[root@545bede4aeb1 volume01]# ls</span><br><span class="line">docker01.txt</span><br><span class="line"></span><br><span class="line"># 再新建docker03.txt</span><br><span class="line">[root@545bede4aeb1 volume01]# touch docker03.txt</span><br><span class="line">[root@545bede4aeb1 volume01]# ls</span><br><span class="line">docker01.txt  docker03.txt</span><br><span class="line"></span><br><span class="line"># 发现docker01中同步成功！</span><br><span class="line">[root@6f3103cdfacb volume01]# ls</span><br><span class="line">docker01.txt  docker03.txt</span><br><span class="line"># 发现docker02中同步成功！</span><br><span class="line">[root@19e8fc7975fe /]# ls volume01/</span><br><span class="line">docker01.txt  docker03.txt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 删除docker01容器，查看docker02、docker03容器中docker01.txt文件是否存在</span><br><span class="line">grx@ubuntu:~$ docker rm -f docker01</span><br><span class="line">docker01</span><br><span class="line"></span><br><span class="line"># 经测试，数据依然存在！</span><br><span class="line">grx@ubuntu:~$ docker attach docker02</span><br><span class="line">[root@19e8fc7975fe /]# ls volume01/</span><br><span class="line">docker01.txt  docker03.txt</span><br><span class="line"></span><br><span class="line">grx@ubuntu:~$ docker attach docker03</span><br><span class="line">[root@545bede4aeb1 volume01]# ls</span><br><span class="line">docker01.txt  docker03.txt</span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-4e09155111a78f2a0073be38285a2241_1440w.webp" alt="img"></p>
<p>多个mysql实现数据共享</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">grx@ubuntu:~$ docker run -d -p 3310:3306 -v /etc/mysql/conf.d/ -v /var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql01 mysql:5.7</span><br><span class="line"></span><br><span class="line">grx@ubuntu:~$ docker run -d -p 3311:3306 -e MYSQL_ROOT_PASSWORD=123456 --name mysql02 --volumes-from mysql01 mysql:5.7</span><br></pre></td></tr></table></figure>

<p><strong>结论：</strong></p>
<p>容器之间配置信息的传递，数据卷容器的生命周期一直持续到没有容器使用为止。</p>
<p>但是一旦持久化到了本地，这个时候本地的数据是不会删除的。</p>
<h3 id="六、Dockerfile"><a href="#六、Dockerfile" class="headerlink" title="六、Dockerfile"></a>六、Dockerfile</h3><h3 id="1-Dockerfile介绍"><a href="#1-Dockerfile介绍" class="headerlink" title="1. Dockerfile介绍"></a>1. Dockerfile介绍</h3><p>Dockerfile是用来构建docker镜像的文件。命令脚本！</p>
<p>构建步骤：</p>
<p>1、编写一个Dockerfile文件</p>
<p>2、docker build 构建成一个镜像</p>
<p>3、docker run 运行镜像</p>
<p>4、docker push 发布镜像（DockerHub、阿里云镜像仓库）</p>
<p>查看一下官方是怎么做的？</p>
<p><img src="/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-4dac5bbaf915c8fade298d757868c437_1440w.webp" alt="img"></p>
<p><img src="/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-10f2a6ebc35e0037789f01b6518b93b1_1440w.webp" alt="img"></p>
<p>很多官方镜像都是基础包，很多功能没有，我们通常会自己搭建自己的镜像！</p>
<h3 id="2-Dockerfile构建过程"><a href="#2-Dockerfile构建过程" class="headerlink" title="2. Dockerfile构建过程"></a>2. Dockerfile构建过程</h3><p><strong>基础知识：</strong></p>
<p>1、每个保留关键字（指令）必须是大写字母</p>
<p>2、执行从上到下顺序执行</p>
<p>3、#表示注释</p>
<p>4、每一个指令都会创建提交一个新的镜像层</p>
<p><img src="/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-d2230583e661447f179012637b69c156_1440w.webp" alt="img"></p>
<p>Dockerfile是面向开发的，以后发布项目，做镜像，就需要编写Dockerfile。</p>
<p>Docker镜像逐渐成为企业交付的标准！</p>
<p>步骤：开发、部署、运维。。。</p>
<p>Dockerfile：构建文件，定义了一切步骤，源代码</p>
<p>DockerImages：通过DockerFile构建生成一个镜像，最终发布运行的产品</p>
<p>Docker容器：容器是镜像运行起来提供的服务</p>
<h3 id="3-Dockerfile指令"><a href="#3-Dockerfile指令" class="headerlink" title="3. Dockerfile指令"></a>3. Dockerfile指令</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">FROM            # 基础镜像，一切从这里开始构建</span><br><span class="line">MAINTAINER      # 镜像是谁写的，姓名+邮箱</span><br><span class="line">RUN             # 镜像构建的时候需要运行的命令</span><br><span class="line">ADD             # 步骤: tomcat镜像，这个tomcat压缩包!添加内容</span><br><span class="line">WORKDIR         # 镜像的工作目录</span><br><span class="line">VOLUME          # 挂载的目录</span><br><span class="line">EXPOSE          # 保留端口配置</span><br><span class="line">CMD             # 指定这个容器启动的时候要运行的命令,只有最后一个会生效，可被替代</span><br><span class="line">ENTRYPOINT      # 指定这个容器启动的时候要运行的命令,可以追加命令</span><br><span class="line">ONBUILD         # 当构建一个被继承DockerFile 这个时候就会运行ONBUILD 的指令。触发指令。</span><br><span class="line">COPY            # 类似ADD，将我们文件拷贝到镜像中</span><br><span class="line">ENV             # 构建的时候设置环境变量!</span><br></pre></td></tr></table></figure>

<h3 id="4-实战测试"><a href="#4-实战测试" class="headerlink" title="4. 实战测试"></a>4. 实战测试</h3><p>DockerHub中99%的镜像都是从这个基础镜像（FROM scratch）过来的，然后配置需要的软件来进行构建。</p>
<p><img src="/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-10f2a6ebc35e0037789f01b6518b93b1_1440w.webp" alt="img"></p>
<p>创建一个自己的centos：</p>
<p>编写DockerFile文件</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">grx@ubuntu:~/docker-study$ vim dockerfile-centos</span><br><span class="line"># dockerfile内容如下：</span><br><span class="line"></span><br><span class="line">FROM centos</span><br><span class="line">MAINTAINER youngJ&lt;youngj5788@google.com&gt;</span><br><span class="line"></span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line"></span><br><span class="line">RUN yum -y install vim</span><br><span class="line">RUN yum -y install net-tools</span><br><span class="line"></span><br><span class="line">EXPOSE 80</span><br><span class="line"></span><br><span class="line">CMD echo $MYPATH</span><br><span class="line">CMD echo &quot;----success----&quot;</span><br><span class="line">CMD /bin/bash</span><br></pre></td></tr></table></figure>

<p>构建镜像</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># docker build -f 脚本路径 -t 镜像名:版本号 .</span><br><span class="line">grx@ubuntu:~/docker-study$ docker build -f dockerfile-centos -t mycentos:0.1 .</span><br></pre></td></tr></table></figure>

<p>运行测试</p>
<p>对比之前的centos：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">grx@ubuntu:~/docker-study$ docker run -it centos</span><br><span class="line"></span><br><span class="line"># 工作目录默认是根目录</span><br><span class="line">[root@588dceca9299 /]# pwd</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line"># 没有这些命令</span><br><span class="line">[root@588dceca9299 /]# vim</span><br><span class="line">bash: vim: command not found</span><br><span class="line">[root@588dceca9299 /]# ifconfig</span><br><span class="line">bash: ifconfig: command not found</span><br></pre></td></tr></table></figure>

<p>增加之后现在的centos：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">grx@ubuntu:~/docker-study$ docker run -it mycentos:0.1</span><br><span class="line">[root@3c523eeeef13 local]# pwd</span><br><span class="line">/usr/local</span><br><span class="line"></span><br><span class="line">[root@3c523eeeef13 local]# which vim</span><br><span class="line">/usr/bin/vim</span><br><span class="line">[root@3c523eeeef13 local]# which ifconfig</span><br><span class="line">/usr/sbin/ifconfig</span><br></pre></td></tr></table></figure>

<p>查看镜像历史构建信息：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">grx@ubuntu:~/docker-study$ docker history mycentos:0.1</span><br><span class="line">IMAGE          CREATED         CREATED BY                                      SIZE      COMMENT</span><br><span class="line">6961e732479e   6 minutes ago   /bin/sh -c #(nop)  CMD [&quot;/bin/sh&quot; &quot;-c&quot; &quot;/bin…   0B</span><br><span class="line">359d30125693   6 minutes ago   /bin/sh -c #(nop)  CMD [&quot;/bin/sh&quot; &quot;-c&quot; &quot;echo…   0B</span><br><span class="line">588b6a3bb3df   6 minutes ago   /bin/sh -c #(nop)  CMD [&quot;/bin/sh&quot; &quot;-c&quot; &quot;echo…   0B</span><br><span class="line">ce27e119f73c   6 minutes ago   /bin/sh -c #(nop)  EXPOSE 80                    0B</span><br><span class="line">b25dd1bfc733   6 minutes ago   /bin/sh -c yum -y install net-tools             23.3MB</span><br><span class="line">a09cfc90b83a   6 minutes ago   /bin/sh -c yum -y install vim                   58MB</span><br><span class="line">20ef0594e680   6 minutes ago   /bin/sh -c #(nop) WORKDIR /usr/local            0B</span><br><span class="line">c1dcf9234a16   6 minutes ago   /bin/sh -c #(nop)  ENV MYPATH=/usr/local        0B</span><br><span class="line">979a0c87b323   6 minutes ago   /bin/sh -c #(nop)  MAINTAINER grx&lt;guorongxun…   0B</span><br><span class="line">300e315adb2f   7 weeks ago     /bin/sh -c #(nop)  CMD [&quot;/bin/bash&quot;]            0B</span><br><span class="line">&lt;missing&gt;      7 weeks ago     /bin/sh -c #(nop)  LABEL org.label-schema.sc…   0B</span><br><span class="line">&lt;missing&gt;      7 weeks ago     /bin/sh -c #(nop) ADD file:bd7a2aed6ede423b7…   209MB</span><br></pre></td></tr></table></figure>

<p>这样我们平时拿到一个镜像，可以研究一下它是怎么构建的。</p>
<blockquote>
<p>CMD和ENTRYPOINT的区别</p>
</blockquote>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CMD         # 指定这个容器启动时要运行的命令，只有最后一个会生效，可被替代</span><br><span class="line">ENTRYPOINT  # 指定这个容器启动时要运行的命令，可以追加命令</span><br></pre></td></tr></table></figure>

<p>测试CMD：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"># 编写Dockerfile文件</span><br><span class="line">grx@ubuntu:~/docker-study$ vim dockerfile-cmd-test</span><br><span class="line">FROM centos</span><br><span class="line">CMD [&quot;ls&quot;, &quot;-a&quot;]</span><br><span class="line"></span><br><span class="line"># 构建镜像</span><br><span class="line">grx@ubuntu:~/docker-study$ docker build -f dockerfile-cmd-test -t cmdtest .</span><br><span class="line">Sending build context to Docker daemon  3.072kB</span><br><span class="line">Step 1/2 : FROM centos</span><br><span class="line"> ---&gt; 300e315adb2f</span><br><span class="line">Step 2/2 : CMD [&quot;ls&quot;, &quot;-a&quot;]</span><br><span class="line"> ---&gt; Running in d83ef44fcd8d</span><br><span class="line">Removing intermediate container d83ef44fcd8d</span><br><span class="line"> ---&gt; 7f1080a72967</span><br><span class="line">Successfully built 7f1080a72967</span><br><span class="line">Successfully tagged cmdtest:latest</span><br><span class="line"></span><br><span class="line"># run运行，发现我们的ls -a生效</span><br><span class="line">grx@ubuntu:~/docker-study$ docker run cmdtest</span><br><span class="line">.</span><br><span class="line">..</span><br><span class="line">.dockerenv</span><br><span class="line">bin</span><br><span class="line">dev</span><br><span class="line">etc</span><br><span class="line">home</span><br><span class="line">lib</span><br><span class="line">lib64</span><br><span class="line">lost+found</span><br><span class="line">media</span><br><span class="line">mnt</span><br><span class="line">opt</span><br><span class="line">proc</span><br><span class="line">root</span><br><span class="line">run</span><br><span class="line">sbin</span><br><span class="line">srv</span><br><span class="line">sys</span><br><span class="line">tmp</span><br><span class="line">usr</span><br><span class="line">var</span><br><span class="line"></span><br><span class="line"># 想追加一个命令 -l，ls -al</span><br><span class="line">grx@ubuntu:~/docker-study$ docker run cmdtest -l</span><br><span class="line">docker: Error response from daemon: OCI runtime create failed: container_linux.go:370: starting container process caused: exec: &quot;-l&quot;: executable file not found in $PATH: unknown.</span><br><span class="line"># CMD的情况下，-l替换了CMD[&quot;ls&quot;, &quot;-a&quot;]命令，所以报错</span><br></pre></td></tr></table></figure>

<p>测试ENTRYPOINT：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">grx@ubuntu:~/docker-study$ vim dockerfile-entrypoint-test</span><br><span class="line">FROM centos</span><br><span class="line">ENTRYPOINT [&quot;ls&quot;, &quot;-a&quot;]</span><br><span class="line"></span><br><span class="line">grx@ubuntu:~/docker-study$ docker build -f dockerfile-entrypoint-test -t entrypoint-test .</span><br><span class="line">Sending build context to Docker daemon  4.096kB</span><br><span class="line">Step 1/2 : FROM centos</span><br><span class="line"> ---&gt; 300e315adb2f</span><br><span class="line">Step 2/2 : ENTRYPOINT [&quot;ls&quot;, &quot;-a&quot;]</span><br><span class="line"> ---&gt; Running in de6a93f2684b</span><br><span class="line">Removing intermediate container de6a93f2684b</span><br><span class="line"> ---&gt; 1cee1c5c6dcd</span><br><span class="line">Successfully built 1cee1c5c6dcd</span><br><span class="line">Successfully tagged entrypoint-test:latest</span><br><span class="line"></span><br><span class="line"># 追加的命令直接拼接在ENTRYPOINT命令后面</span><br><span class="line">grx@ubuntu:~/docker-study$ docker run entrypoint-test -l</span><br><span class="line">total 56</span><br><span class="line">drwxr-xr-x  23 root root 4096 Jan 30 06:41 .</span><br><span class="line">drwxr-xr-x  23 root root 4096 Jan 30 06:41 ..</span><br><span class="line">-rwxr-xr-x   1 root root    0 Jan 30 06:41 .dockerenv</span><br><span class="line">lrwxrwxrwx   1 root root    7 Nov  3 15:22 bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x   5 root root  340 Jan 30 06:41 dev</span><br><span class="line">drwxr-xr-x  52 root root 4096 Jan 30 06:41 etc</span><br><span class="line">drwxr-xr-x   2 root root 4096 Nov  3 15:22 home</span><br><span class="line">lrwxrwxrwx   1 root root    7 Nov  3 15:22 lib -&gt; usr/lib</span><br><span class="line">lrwxrwxrwx   1 root root    9 Nov  3 15:22 lib64 -&gt; usr/lib64</span><br><span class="line">drwx------   2 root root 4096 Dec  4 17:37 lost+found</span><br><span class="line">drwxr-xr-x   2 root root 4096 Nov  3 15:22 media</span><br><span class="line">drwxr-xr-x   2 root root 4096 Nov  3 15:22 mnt</span><br><span class="line">drwxr-xr-x   2 root root 4096 Nov  3 15:22 opt</span><br><span class="line">dr-xr-xr-x 206 root root    0 Jan 30 06:41 proc</span><br><span class="line">dr-xr-x---   2 root root 4096 Dec  4 17:37 root</span><br><span class="line">drwxr-xr-x  11 root root 4096 Dec  4 17:37 run</span><br><span class="line">lrwxrwxrwx   1 root root    8 Nov  3 15:22 sbin -&gt; usr/sbin</span><br><span class="line">drwxr-xr-x   2 root root 4096 Nov  3 15:22 srv</span><br><span class="line">dr-xr-xr-x  13 root root    0 Jan 30 02:53 sys</span><br><span class="line">drwxrwxrwt   7 root root 4096 Dec  4 17:37 tmp</span><br><span class="line">drwxr-xr-x  12 root root 4096 Dec  4 17:37 usr</span><br><span class="line">drwxr-xr-x  20 root root 4096 Dec  4 17:37 var</span><br></pre></td></tr></table></figure>

<h3 id="5-实战生成自定义tomcat镜像"><a href="#5-实战生成自定义tomcat镜像" class="headerlink" title="5. 实战生成自定义tomcat镜像"></a>5. 实战生成自定义tomcat镜像</h3><p>1、准备tomcat压缩包和jdk的压缩包</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grx@ubuntu:~/docker-study/tomcat$ ls</span><br><span class="line">apache-tomcat-9.0.34.tar.gz  jdk-8u281-linux-x64.tar.gz</span><br></pre></td></tr></table></figure>

<p>2、编写Dockerfile文件，官方命名<code>Dockerfile</code>，build的时候会自动寻找这个文件，不需要 -f 指定。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">FROM centos</span><br><span class="line">MAINTAINER grx&lt;guorongxun@gmail.com&gt;</span><br><span class="line"></span><br><span class="line">COPY readme.txt /usr/local/readme.txt   # 这一行执行前首先要确保readme.txt存在</span><br><span class="line"></span><br><span class="line">ADD jdk-8u281-linux-x64.tar.gz /usr/local/</span><br><span class="line">ADD apache-tomcat-9.0.34.tar.gz /usr/local/</span><br><span class="line"></span><br><span class="line">RUN yum -y install vim</span><br><span class="line"></span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line"></span><br><span class="line">ENV JAVA_HOME /usr/local/jdk1.8.0_281</span><br><span class="line">ENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class="line">ENV CATALINA_HOME /usr/local/apache-tomcat-9.0.34</span><br><span class="line">ENV CATALINA_BASH /usr/local/apache-tomcat-9.0.34</span><br><span class="line">ENV PATH $PATH:$JAVA_HOME/bin:$CATALINA_HOME/lib:$CATALINA_HOME/bin</span><br><span class="line"></span><br><span class="line">EXPOSE 8080</span><br><span class="line"></span><br><span class="line">CMD /usr/local/apache-tomcat-9.0.34/bin/startup.sh &amp;&amp; tail -F /usr/local/apache-tomcat-9</span><br><span class="line">.0.34/bin/logs/catalina.out</span><br></pre></td></tr></table></figure>

<p>3、构建镜像</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grx@ubuntu:~/docker-study/tomcat$ docker build -t diytomcat .</span><br></pre></td></tr></table></figure>

<p>4、启动镜像</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grx@ubuntu:~/docker-study/tomcat$ docker run -d -p 8080:8080 --name mytomcat -v /home/grx/docker-study/tomcat/test:/usr/local/apache-tomcat-9.0.34/webapps/test -v /home/grx/docker-study/tomcat/logs:/usr/local/apache-tomcat-9.0.34/logs diytomcat</span><br></pre></td></tr></table></figure>

<p>5、访问测试</p>
<p><img src="/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-83bc0a1349dab2d71492e13e6c5b144c_1440w.webp" alt="img"></p>
<p>6、发布项目（由于做了卷挂载，直接在本地编写项目就可以发布）</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># 新建web.xml</span><br><span class="line">root@ubuntu:/home/grx/docker-study/tomcat/test# mkdir WEB-INF</span><br><span class="line">root@ubuntu:/home/grx/docker-study/tomcat/test# cd WEB-INF</span><br><span class="line">root@ubuntu:/home/grx/docker-study/tomcat/WEB-INF# vim web.xml</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;web-app xmlns=&quot;http://java.sun.com/xml/ns/javaee&quot;</span><br><span class="line">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/javaee</span><br><span class="line">                             http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot; version=&quot;2.5&quot;&gt;</span><br><span class="line">&lt;/web-app&gt;</span><br><span class="line"># 新建index.jsp</span><br><span class="line">root@ubuntu:/home/grx/docker-study/tomcat/test# vim index.jsp</span><br><span class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;</span><br><span class="line">    pageEncoding=&quot;UTF-8&quot;%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class="line">        &lt;title&gt;youngj&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        Hello World!&lt;br/&gt;</span><br><span class="line">        &lt;%</span><br><span class="line">        System.out.println(&quot;-----my test web logs-----&quot;);</span><br><span class="line">        %&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-f7ddd5fe1a5e6e6c739a89978e71c883_1440w.webp" alt="img"></p>
<p>发现：项目部署成功，可以直接访问！</p>
<p>需要掌握Dockerfile的编写，使用docker镜像来发布运行。</p>
<h3 id="6-发布自己的镜像"><a href="#6-发布自己的镜像" class="headerlink" title="6. 发布自己的镜像"></a>6. 发布自己的镜像</h3><blockquote>
<p>DockerHub</p>
</blockquote>
<p>1、地址 <a href="https://link.zhihu.com/?target=https://hub.docker.com/">https://hub.docker.com/</a> 注册自己的账号</p>
<p>2、确定这个账号可以登陆</p>
<p>3、在服务器上提交自己的镜像</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">grx@ubuntu:~/docker-study$ docker login --help</span><br><span class="line"></span><br><span class="line">Usage:  docker login [OPTIONS] [SERVER]</span><br><span class="line"></span><br><span class="line">Log in to a Docker registry.</span><br><span class="line">If no server is specified, the default is defined by the daemon.</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -p, --password string   Password</span><br><span class="line">      --password-stdin    Take the password from stdin</span><br><span class="line">  -u, --username string   Username</span><br><span class="line"></span><br><span class="line">grx@ubuntu:~/docker-study$ docker login -u guorongxun</span><br><span class="line">Password:</span><br><span class="line">WARNING! Your password will be stored unencrypted in /home/grx/.docker/config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span><br><span class="line"></span><br><span class="line">Login Succeeded</span><br></pre></td></tr></table></figure>

<p>4、登录完毕就可以提交镜像了，docker push</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">grx@ubuntu:~/docker-study$ docker push diytomcat</span><br><span class="line">Using default tag: latest</span><br><span class="line">The push refers to repository [docker.io/library/diytomcat]</span><br><span class="line">9caaf6747906: Preparing</span><br><span class="line">d5713be737b0: Preparing</span><br><span class="line">eb261fd2705b: Preparing</span><br><span class="line">b2a4e7e42e62: Preparing</span><br><span class="line">2653d992f4ef: Preparing</span><br><span class="line">denied: requested access to the resource is denied # 被拒绝</span><br><span class="line"></span><br><span class="line"># 解决：增加一个tag</span><br><span class="line">grx@ubuntu:~/docker-study$ docker tag 8d4c72ed3438 guorongxun/tomcat:1.0</span><br><span class="line"></span><br><span class="line"># docker push 上去即可。自己发布的镜像尽量带上版本号</span><br><span class="line"># 提交的时候也是按照镜像的层级来提交的</span><br><span class="line">grx@ubuntu:~/docker-study$ docker push guorongxun/tomcat:1.0</span><br><span class="line">The push refers to repository [docker.io/guorongxun/tomcat]</span><br><span class="line">9caaf6747906: Pushed</span><br><span class="line">d5713be737b0: Pushed</span><br><span class="line">eb261fd2705b: Pushed</span><br><span class="line">b2a4e7e42e62: Pushed</span><br><span class="line">2653d992f4ef: Pushed</span><br><span class="line">1.0: digest: sha256:df541d5b1478de500bb3bb5ed723589e2bd6e988b8d2a2107cacbe7b9f8eae7d size: 1373</span><br></pre></td></tr></table></figure>

<blockquote>
<p>阿里云镜像</p>
</blockquote>
<p>1、登陆阿里云</p>
<p> <a href="https://link.zhihu.com/?target=https://www.aliyun.com/">阿里云官网</a></p>
<p>2、找到容器镜像服务</p>
<p>3、创建命名空间</p>
<p><img src="/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-814bc378b5bc8eb04b895df7743dc92c_1440w.png" alt="img"></p>
<p>4、创建容器镜像</p>
<p><img src="/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-2077c77569ba336c2e1ccfa46548e4ca_1440w.webp" alt="img"></p>
<p>5、浏览阿里云</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">1. 登录阿里云Docker Registry</span><br><span class="line">$ sudo docker login --username=guorongxun1996 registry.cn-hangzhou.aliyuncs.com</span><br><span class="line">用于登录的用户名为阿里云账号全名，密码为开通服务时设置的密码。</span><br><span class="line">您可以在访问凭证页面修改凭证密码。</span><br><span class="line"></span><br><span class="line">2. 从Registry中拉取镜像</span><br><span class="line">$ sudo docker pull registry.cn-hangzhou.aliyuncs.com/guorongxun/docker-test:[镜像版本号]</span><br><span class="line"></span><br><span class="line">3. 将镜像推送到Registry</span><br><span class="line">$ sudo docker login --username=guorongxun1996 registry.cn-hangzhou.aliyuncs.com</span><br><span class="line">$ sudo docker tag [ImageId] registry.cn-hangzhou.aliyuncs.com/guorongxun/docker-test:[镜像版本号]</span><br><span class="line">$ sudo docker push registry.cn-hangzhou.aliyuncs.com/guorongxun/docker-test:[镜像版本号]</span><br><span class="line">请根据实际镜像信息替换示例中的[ImageId]和[镜像版本号]参数。</span><br><span class="line"></span><br><span class="line">4. 选择合适的镜像仓库地址</span><br><span class="line">从ECS推送镜像时，可以选择使用镜像仓库内网地址。推送速度将得到提升并且将不会损耗您的公网流量。</span><br><span class="line">如果您使用的机器位于VPC网络，请使用 registry-vpc.cn-hangzhou.aliyuncs.com 作为Registry的域名登录。</span><br></pre></td></tr></table></figure>

<h3 id="7-小结"><a href="#7-小结" class="headerlink" title="7. 小结"></a>7. 小结</h3><p><img src="/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-206af31f11f8121e681415fb3779626f_1440w.webp" alt="img"></p>
<h3 id="七、Docker网络"><a href="#七、Docker网络" class="headerlink" title="七、Docker网络"></a>七、Docker网络</h3><h3 id="1-理解Docker0"><a href="#1-理解Docker0" class="headerlink" title="1. 理解Docker0"></a>1. 理解Docker0</h3><blockquote>
<p>测试</p>
</blockquote>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">grx@ubuntu:~/docker-study$ ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 00:0c:29:28:6d:3f brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.10.133/24 brd 192.168.10.255 scope global ens33</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet 192.168.1.50/32 scope global ens33</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::20c:29ff:fe28:6d3f/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"># docker0地址</span><br><span class="line">3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default</span><br><span class="line">    link/ether 02:42:5d:1c:f9:d1 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<p>问题：docker 是如何处理容器之间网络访问的？</p>
<p><img src="/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-d0f186f0fdc9524db88dc50456a34891_1440w.webp" alt="img"></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">grx@ubuntu:~/docker-study$ docker run -d -P --name tomcat01 tomcat</span><br><span class="line"></span><br><span class="line"># 查看容器内网络地址ip addr, 发现容器启动的时候会得到一个eth0@if5 IP地址，是docker分配的</span><br><span class="line">grx@ubuntu:~/docker-study$ docker exec -it tomcat01 ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">4: eth0@if5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default</span><br><span class="line">    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line"># 经测试，宿主机是可以ping通容器的</span><br><span class="line">grx@ubuntu:~/docker-study$ ping 172.17.0.2</span><br><span class="line">PING 172.17.0.2 (172.17.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=1 ttl=64 time=0.060 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=2 ttl=64 time=0.090 ms</span><br></pre></td></tr></table></figure>

<blockquote>
<p>原理</p>
</blockquote>
<p>1、每启动一个docker容器，docker就会给容器分配一个IP，只要我们安装了docker就会有一个网卡docker0，使用的是桥接模式，veth-pair技术。</p>
<p>再来看网卡信息 ip addr, 正好对应容器内网卡信息</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">5: veth3338982@if4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default</span><br><span class="line">    link/ether 12:26:77:38:be:cd brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet6 fe80::1026:77ff:fe38:becd/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<p>2、再启动一个容器，发现又多了一个网卡</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">grx@ubuntu:~/docker-study$ docker run -d -P --name tomcat02 tomcat</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">7: veth7b3b050@if6: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default</span><br><span class="line">    link/ether 2a:69:20:39:a2:5f brd ff:ff:ff:ff:ff:ff link-netnsid 1</span><br><span class="line">    inet6 fe80::2869:20ff:fe39:a25f/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<p>我们发现，这个容器带来的网卡都是一对一对的</p>
<p>veth-pair 就是一对虚拟设备接口，他们都是成对出现，一端连着协议，一端彼此相连</p>
<p>veth-pair充当于一个桥梁，连接各种网络设备</p>
<p>3、测试tomcat02是否能够ping通Tomcat01</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">grx@ubuntu:~/docker-study$ docker exec -it tomcat02 ping 172.17.0.2</span><br><span class="line">PING 172.17.0.2 (172.17.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=1 ttl=64 time=0.081 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=2 ttl=64 time=0.055 ms</span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-2d1143b9bde6164b0517cd7f6c9bd5cf_1440w.webp" alt="img"></p>
<p>结论： tomcat01 和 tomcat02是公用的一个路由器，docker0</p>
<p>所有的容器在不指定网络的情况下，都是docker0来路由的，docker会给我们分配一个默认的可用IP！</p>
<blockquote>
<p>小结</p>
</blockquote>
<p>Docker使用的是Linux的桥接。宿主机是一个Docker容器的网桥docker0。</p>
<p><img src="/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-8da5b050d26178cc4345df0673bd55ad_1440w.webp" alt="img"></p>
<p>Docker中所有的网络接口都是虚拟的。虚拟的转发效率高！</p>
<p>只要容器删除，对应的一对网桥就没了。</p>
<h3 id="2-–link"><a href="#2-–link" class="headerlink" title="2. –link"></a>2. –link</h3><blockquote>
<p>思考一个场景，我们编写了一个微服务，比如mysql的连接地址为：database.url&#x3D;ip:port，数据库IP换掉了，我们想不重启解决这个问题，可以通过名字访问容器</p>
</blockquote>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># 怎么解决下面的问题？</span><br><span class="line">grx@ubuntu:~/docker-study$ docker exec -it tomcat02 ping tomcat01</span><br><span class="line">ping: tomcat01: Temporary failure in name resolution</span><br><span class="line"></span><br><span class="line"># 通过--link就可以解决网络连通问题</span><br><span class="line"># 使用--link再启动一个tomcat03</span><br><span class="line">grx@ubuntu:~/docker-study$ docker run -d -P --name tomcat03 --link tomcat02 tomcat</span><br><span class="line">82ecc97048da384ef81022a5fcbbc12278f74949437defa998a79db208f6afed</span><br><span class="line">grx@ubuntu:~/docker-study$ docker exec -it tomcat03 ping tomcat02</span><br><span class="line">PING tomcat02 (172.17.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat02 (172.17.0.3): icmp_seq=1 ttl=64 time=0.071 ms</span><br><span class="line">64 bytes from tomcat02 (172.17.0.3): icmp_seq=2 ttl=64 time=0.066 ms</span><br><span class="line"></span><br><span class="line"># 我们发现tomcat03是可以ping通Tomcat02的，那么反过来可以吗？</span><br><span class="line">grx@ubuntu:~/docker-study$ docker exec -it tomcat02 ping tomcat03</span><br><span class="line">ping: tomcat03: Temporary failure in name resolution</span><br></pre></td></tr></table></figure>

<p>探究：inspect</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">grx@ubuntu:~/docker-study$ docker network ls</span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">c08d1685aeba   bridge    bridge    local</span><br><span class="line">9d2b1da969f4   host      host      local</span><br><span class="line">82a620858c5e   none      null      local</span><br><span class="line">grx@ubuntu:~/docker-study$ docker network inspect c08d1685aeba</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">&quot;Containers&quot;: &#123;</span><br><span class="line">            &quot;73ca2f668153a9e70c65ead3f3c12bae6e8f8da0f4e7a75353b8aec0d0352611&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat02&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;692bc5e54c9a73e9211fa66ce2a85b331e23a77e9d943b9ce0b153249720a8cc&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:ac:11:00:03&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;172.17.0.3/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;82ecc97048da384ef81022a5fcbbc12278f74949437defa998a79db208f6afed&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat03&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;3e767c5b1536df23953b4261da58e44b4867b3ed779ebccbeee298991ae915be&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:ac:11:00:04&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;172.17.0.4/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;a393b6a7688f1638980ed6f50891d6a1bfe46377f0038ebe0bfb841c1649abea&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat01&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;335eb0073eea24415e28f07e306a903146c40f0c34429b48fd52e730c3417fcc&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;172.17.0.2/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>其实tomcat03就是在本地配置了tomcat02的配置：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 查看hosts配置</span><br><span class="line">grx@ubuntu:~/docker-study$ docker exec -it tomcat03 cat /etc/hosts</span><br><span class="line">127.0.0.1       localhost</span><br><span class="line">::1     localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::0 ip6-localnet</span><br><span class="line">ff00::0 ip6-mcastprefix</span><br><span class="line">ff02::1 ip6-allnodes</span><br><span class="line">ff02::2 ip6-allrouters</span><br><span class="line">172.17.0.3      tomcat02 73ca2f668153 # --link就是在hosts中增加了这个！</span><br><span class="line">172.17.0.4      82ecc97048da</span><br></pre></td></tr></table></figure>

<p>现在已经不推荐–link这种方式！</p>
<p>使用自定义网络，而不使用docker0！</p>
<p>docker0问题：不支持容器名连接访问！</p>
<h3 id="3-自定义网络"><a href="#3-自定义网络" class="headerlink" title="3. 自定义网络"></a>3. 自定义网络</h3><blockquote>
<p>查看所有的docker网络</p>
</blockquote>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">grx@ubuntu:~/docker-study$ docker network ls</span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">c08d1685aeba   bridge    bridge    local</span><br><span class="line">9d2b1da969f4   host      host      local</span><br><span class="line">82a620858c5e   none      null      local</span><br></pre></td></tr></table></figure>

<p><strong>网络模式</strong></p>
<p>bridge：桥接 docker（默认，自己创建也使用bridge模式）</p>
<p>none：不配置网络</p>
<p>host：和宿主机共享网络</p>
<p>container：容器网络连通（用的少）</p>
<p><strong>测试</strong></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"># 我们直接启动的命令 --net bridge, 而这个就是我们的docker0，下面两条等价</span><br><span class="line"># docker run -d -P --name tomcat01 tomcat</span><br><span class="line"># docker run -d -P --name tomcat01 --net bridge tomcat</span><br><span class="line"></span><br><span class="line"># docker0的特点：默认，域名不能访问，可以通过--link打通，但是太麻烦，不推荐！</span><br><span class="line"># 我们可以自定义一个网络</span><br><span class="line"># --driver bridge</span><br><span class="line"># --subnet 192.168.0.0/16</span><br><span class="line"># --gateway 192.168.0.1</span><br><span class="line">grx@ubuntu:~/docker-study$ docker network create --driver bridge --subnet 192.168.0.0/16 --gateway 192.168.0.1 mynet</span><br><span class="line">a805c2430ab4205cfbab49f50c2184ca193accd6885f322ffa4166e3c1c06ef9</span><br><span class="line">grx@ubuntu:~/docker-study$ docker network ls</span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">c08d1685aeba   bridge    bridge    local</span><br><span class="line">9d2b1da969f4   host      host      local</span><br><span class="line">a805c2430ab4   mynet     bridge    local</span><br><span class="line">82a620858c5e   none      null      local</span><br><span class="line"></span><br><span class="line"># 我们自己的网络就建好了</span><br><span class="line">grx@ubuntu:~/docker-study$ docker network inspect mynet</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">&quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">            &quot;Config&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Subnet&quot;: &quot;192.168.0.0/16&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;192.168.0.1&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"># 启动两个tomcat，测试是否互通</span><br><span class="line">grx@ubuntu:~/docker-study$ docker run -d -P --name tomcat-net-01 --net mynet tomcat</span><br><span class="line">3fcf87e973a45781982180066ef7a8eedcc34e9271a4f82ddbc65deaac70a0b6</span><br><span class="line">grx@ubuntu:~/docker-study$ docker run -d -P --name tomcat-net-02 --net mynet tomcat</span><br><span class="line">95017a857cc78f3dc2cb3ccf7b8e81ad1e089ee38a765867b489723a501571fc</span><br><span class="line">grx@ubuntu:~/docker-study$ docker network inspect mynet</span><br><span class="line">...</span><br><span class="line">        &quot;Containers&quot;: &#123;</span><br><span class="line">            &quot;3fcf87e973a45781982180066ef7a8eedcc34e9271a4f82ddbc65deaac70a0b6&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat-net-01&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;1f788021831591c27e053ec21458e50eb468ec5e723cbdb1e3597156b6c4065f&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:02&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;192.168.0.2/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;95017a857cc78f3dc2cb3ccf7b8e81ad1e089ee38a765867b489723a501571fc&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat-net-02&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;89a3f6a6a2839ca1f0fd7cfc3bc39f04237f350abd6ce9f5f7c977a8f2ce6301&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:03&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;192.168.0.3/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"># 再次测试ping连接</span><br><span class="line">grx@ubuntu:~/docker-study$ docker exec -it tomcat-net-01 ping 192.168.0.3</span><br><span class="line">PING 192.168.0.3 (192.168.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from 192.168.0.3: icmp_seq=1 ttl=64 time=0.101 ms</span><br><span class="line">64 bytes from 192.168.0.3: icmp_seq=2 ttl=64 time=0.076 ms</span><br><span class="line">^C</span><br><span class="line"></span><br><span class="line"># 不使用--link也可以直接ping域名</span><br><span class="line">grx@ubuntu:~/docker-study$ docker exec -it tomcat-net-01 ping tomcat-net-02</span><br><span class="line">PING tomcat-net-02 (192.168.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=1 ttl=64 time=0.060 ms</span><br><span class="line">64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=2 ttl=64 time=0.077 ms</span><br></pre></td></tr></table></figure>

<p>我们自定义的网络，docker都已经帮我们维护好了对应关系，推荐这样使用！</p>
<p>好处：不同集群使用不同网络，保证集群安全、健康</p>
<h3 id="4-网络连通"><a href="#4-网络连通" class="headerlink" title="4. 网络连通"></a>4. 网络连通</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">grx@ubuntu:~/docker-study$ docker network connect --help</span><br><span class="line"></span><br><span class="line">Usage:  docker network connect [OPTIONS] NETWORK CONTAINER</span><br><span class="line"></span><br><span class="line">Connect a container to a network</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --alias strings           Add network-scoped alias for the container</span><br><span class="line">      --driver-opt strings      driver options for the network</span><br><span class="line">      --ip string               IPv4 address (e.g., 172.30.100.104)</span><br><span class="line">      --ip6 string              IPv6 address (e.g., 2001:db8::33)</span><br><span class="line">      --link list               Add link to another container</span><br><span class="line">      --link-local-ip strings   Add a link-local address for the container</span><br></pre></td></tr></table></figure>

<p>如果此时我想tomcat01和tomcat-net-01互通，也就是和mynet打通，怎么操作？</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># 将mynet 和 tomcat01打通</span><br><span class="line">grx@ubuntu:~/docker-study$ docker network connect mynet tomcat01</span><br><span class="line">grx@ubuntu:~/docker-study$ docker network inspect mynet</span><br><span class="line">...</span><br><span class="line">&quot;a393b6a7688f1638980ed6f50891d6a1bfe46377f0038ebe0bfb841c1649abea&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat01&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;b4b7edc591e9e8be34335d9a7776f0b8c51434d5409c600f2cb90909b7e286e0&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:04&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;192.168.0.4/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">...</span><br><span class="line"># 发现mynet Containers中多了一个tomcat01容器！</span><br><span class="line"># docker通过一个容器 两个IP方式，如：阿里云公网IP和私网IP，将两个容器打通！</span><br><span class="line"></span><br><span class="line"># tomcat01和mynet连通</span><br><span class="line">grx@ubuntu:~/docker-study$ docker exec -it tomcat01 ping tomcat-net-01</span><br><span class="line">PING tomcat-net-01 (192.168.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat-net-01.mynet (192.168.0.2): icmp_seq=1 ttl=64 time=0.090 ms</span><br><span class="line">64 bytes from tomcat-net-01.mynet (192.168.0.2): icmp_seq=2 ttl=64 time=0.069 ms</span><br><span class="line"># tomcat02和mynet仍不连通</span><br><span class="line">grx@ubuntu:~/docker-study$ docker exec -it tomcat02 ping tomcat-net-01</span><br><span class="line">ping: tomcat-net-01: Temporary failure in name resolution</span><br></pre></td></tr></table></figure>

<p>总结：假如要跨网络操作别人，就需要用docker network connect连接！</p>
<h3 id="5-实战：部署redis集群"><a href="#5-实战：部署redis集群" class="headerlink" title="5. 实战：部署redis集群"></a>5. 实战：部署redis集群</h3><p><img src="/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-e192d7b4e728550f7fe8ef2a15fe45d6_1440w.webp" alt="img"></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"># 创建网卡</span><br><span class="line">grx@ubuntu:~/docker-study$ docker network create redis --subnet 172.38.0.0/16</span><br><span class="line">51205736c0eb6ec63af226744ea85dda354f35dc74d0af89c2fafe125821585f</span><br><span class="line"># 使用脚本创建6个redis配置文件</span><br><span class="line">for port in $(seq 1 6); \</span><br><span class="line">do \</span><br><span class="line">mkdir -p ~/docker-study/redis/node-$&#123;port&#125;/conf</span><br><span class="line">touch ~/docker-study/redis/node-$&#123;port&#125;/conf/redis.conf</span><br><span class="line">cat &lt;&lt; EOF &gt;~/docker-study/redis/node-$&#123;port&#125;/conf/redis.conf</span><br><span class="line">port 6379</span><br><span class="line">bind 0.0.0.0</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes.conf</span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line">cluster-announce-ip 172.38.0.1$&#123;port&#125;</span><br><span class="line">cluster-announce-port 6379</span><br><span class="line">cluster-announce-bus-port 16379</span><br><span class="line">appendonly yes</span><br><span class="line">EOF</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line"># 使用脚本启动6个redis容器</span><br><span class="line">for port in $(seq 1 6); \</span><br><span class="line">do \</span><br><span class="line">docker run -p 637$&#123;port&#125;:6379 -p 1637$&#123;port&#125;:16379 --name redis-$&#123;port&#125; -v ~/docker-study/redis/node-$&#123;port&#125;/data:/data -v ~/docker-study/redis/node-$&#123;port&#125;/conf/redis.conf:/etc/redis/redis.conf -d --net redis --ip 172.38.0.1$&#123;port&#125; redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line">done</span><br><span class="line"># 随便进入一个容器</span><br><span class="line">grx@ubuntu:~/docker-study$ docker exec -it redis-1 /bin/sh</span><br><span class="line"></span><br><span class="line"># 创建集群 </span><br><span class="line">/data # redis-cli --cluster create 172.38.0.11:6379 172.38.0.12:6379 172.38.0.13</span><br><span class="line">:6379 172.38.0.14:6379 172.38.0.15:6379 172.38.0.16:6379 --cluster-replicas 1</span><br><span class="line">...</span><br><span class="line"># 测试主从，当主挂了之后，从是否会成为主</span><br><span class="line">/data # redis-cli -c</span><br><span class="line"></span><br><span class="line"># 查看集群信息</span><br><span class="line">127.0.0.1:6379&gt; cluster info</span><br><span class="line">cluster_state:ok</span><br><span class="line">cluster_slots_assigned:16384</span><br><span class="line">cluster_slots_ok:16384</span><br><span class="line">cluster_slots_pfail:0</span><br><span class="line">cluster_slots_fail:0</span><br><span class="line">cluster_known_nodes:6</span><br><span class="line">cluster_size:3</span><br><span class="line">cluster_current_epoch:6</span><br><span class="line">cluster_my_epoch:1</span><br><span class="line">cluster_stats_messages_ping_sent:482</span><br><span class="line">cluster_stats_messages_pong_sent:481</span><br><span class="line">cluster_stats_messages_sent:963</span><br><span class="line">cluster_stats_messages_ping_received:476</span><br><span class="line">cluster_stats_messages_pong_received:482</span><br><span class="line">cluster_stats_messages_meet_received:5</span><br><span class="line">cluster_stats_messages_received:963</span><br><span class="line"></span><br><span class="line">#查看节点信息，可以看到是三主三从</span><br><span class="line">127.0.0.1:6379&gt; cluster nodes</span><br><span class="line">d8ba985fe2737c65cc5c58f3ba0638ce810a5b22 172.38.0.16:6379@16379 slave c4691d954bb0e7a6dbad6ac57c55c10520543723 0 1612078541668 6 connected</span><br><span class="line">5b6d56bd2565801e8bf51c042e3ad55b6c694376 172.38.0.13:6379@16379 master - 0 1612078540000 3 connected 10923-16383</span><br><span class="line">c4691d954bb0e7a6dbad6ac57c55c10520543723 172.38.0.12:6379@16379 master - 0 1612078541163 2 connected 5461-10922</span><br><span class="line">db02d1c15801dda3c1fab5d62619982bece72fc6 172.38.0.15:6379@16379 slave 01e774a47368e9d0d170504520705d503e2e91d0 0 1612078541000 5 connected</span><br><span class="line">8db2ebb51eeba96616dbd1c5ba543180a8dd4265 172.38.0.14:6379@16379 slave 5b6d56bd2565801e8bf51c042e3ad55b6c694376 0 1612078540658 4 connected</span><br><span class="line">01e774a47368e9d0d170504520705d503e2e91d0 172.38.0.11:6379@16379 myself,master - 0 1612078540000 1 connected 0-5460</span><br><span class="line"></span><br><span class="line"># 随便存一个值，发现存在172.38.0.13:6379</span><br><span class="line">127.0.0.1:6379&gt; set a b</span><br><span class="line">-&gt; Redirected to slot [15495] located at 172.38.0.13:6379</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line"># 当172.38.0.13这台服务挂了之后，测试是否能查询到值</span><br><span class="line"># 停掉redis-3</span><br><span class="line">grx@ubuntu:~$ docker stop redis-3</span><br><span class="line"></span><br><span class="line"># 重新查询</span><br><span class="line">127.0.0.1:6379&gt; get a</span><br><span class="line">-&gt; Redirected to slot [15495] located at 172.38.0.14:6379</span><br><span class="line">&quot;b&quot;</span><br><span class="line"></span><br><span class="line"># 重新查看节点状态，发现172.38.0.13 fail, 172.38.0.14已经成为了master</span><br><span class="line">db02d1c15801dda3c1fab5d62619982bece72fc6 172.38.0.15:6379@16379 slave 01e774a47368e9d0d170504520705d503e2e91d0 0 1612078836633 5 connected</span><br><span class="line">01e774a47368e9d0d170504520705d503e2e91d0 172.38.0.11:6379@16379 master - 0 1612078836000 1 connected 0-5460</span><br><span class="line">5b6d56bd2565801e8bf51c042e3ad55b6c694376 172.38.0.13:6379@16379 master,fail - 1612078775942 1612078774000 3 connected</span><br><span class="line">8db2ebb51eeba96616dbd1c5ba543180a8dd4265 172.38.0.14:6379@16379 myself,master - 0 1612078835000 7 connected 10923-16383</span><br><span class="line">d8ba985fe2737c65cc5c58f3ba0638ce810a5b22 172.38.0.16:6379@16379 slave c4691d954bb0e7a6dbad6ac57c55c10520543723 0 1612078835122 6 connected</span><br><span class="line">c4691d954bb0e7a6dbad6ac57c55c10520543723 172.38.0.12:6379@16379 master - 0 1612078837136 2 connected 5461-10922</span><br></pre></td></tr></table></figure>

<h3 id="八、SpringBoot微服务打包Docker镜像"><a href="#八、SpringBoot微服务打包Docker镜像" class="headerlink" title="八、SpringBoot微服务打包Docker镜像"></a>八、SpringBoot微服务打包Docker镜像</h3><p>1、新建springboot项目</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 新建controller</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello,grx!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、打包应用</p>
<p>3、编写Dockerfile</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 基础镜像 Java8</span><br><span class="line">FROM java:8</span><br><span class="line"></span><br><span class="line"># 把所有的jar 放到app.jar中</span><br><span class="line">COPY *.jar /app.jar</span><br><span class="line"></span><br><span class="line"># 指定端口8080</span><br><span class="line">CMD [&quot;--server.port=8080&quot;]</span><br><span class="line"></span><br><span class="line"># 对外暴露端口8080</span><br><span class="line">EXPOSE 8080</span><br><span class="line"></span><br><span class="line"># 执行命令 java -jar /app.jar</span><br><span class="line">ENTRYPOINT [&quot;java&quot;, &quot;-jar&quot;, &quot;/app.jar&quot;]</span><br></pre></td></tr></table></figure>

<p>4、构建镜像</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grx@ubuntu:~/docker-study/idea$ docker build -t docker-idea:1.0 .</span><br></pre></td></tr></table></figure>

<p>5、发布运行</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">grx@ubuntu:~/docker-study/idea$ docker run -d -P --name demo01 docker-idea:1.0</span><br><span class="line">grx@ubuntu:~/docker-study/idea$ docker ps</span><br><span class="line">CONTAINER ID   IMAGE                    COMMAND                  CREATED          STATUS          PORTS                                              NAMES</span><br><span class="line">dc06296da58a   docker-idea:1.0          &quot;java -jar /app.jar …&quot;   16 seconds ago   Up 14 seconds   0.0.0.0:49158-&gt;8080/tcp                            demo01</span><br><span class="line">grx@ubuntu:~/docker-study/idea$ curl localhost:49158/hello</span><br><span class="line">Hello,grx!</span><br></pre></td></tr></table></figure>

<h3 id="九、Docker-Compose"><a href="#九、Docker-Compose" class="headerlink" title="九、Docker Compose"></a>九、Docker Compose</h3><h3 id="1-简介"><a href="#1-简介" class="headerlink" title="1. 简介"></a>1. 简介</h3><p>官方介绍：</p>
<blockquote>
<p>Compose is a tool for defining and running multi-container Docker applications. With Compose, you use a YAML file to configure your application’s services. Then, with a single command, you create and start all the services from your configuration. To learn more about all the features of Compose, see <a href="https://link.zhihu.com/?target=https://docs.docker.com/compose/%23features">the list of features</a>.<br>Compose works in all environments: production, staging, development, testing, as well as CI workflows. You can learn more about each case in <a href="https://link.zhihu.com/?target=https://docs.docker.com/compose/%23common-use-cases">Common Use Cases</a>.<br>Using Compose is basically a three-step process:</p>
</blockquote>
<ol>
<li>Define your app’s environment with a <code>Dockerfile</code> so it can be reproduced anywhere.</li>
<li>Define the services that make up your app in <code>docker-compose.yml</code> so they can be run together in an isolated environment.</li>
<li>Run <code>docker-compose up</code> and Compose starts and runs your entire app.</li>
</ol>
<p>下面是一个docker-compose.yml示例：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">version: &quot;3.9&quot;  # optional since v1.27.0</span><br><span class="line">services:</span><br><span class="line">  web:</span><br><span class="line">    build: .</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;5000:5000&quot;</span><br><span class="line">    volumes:</span><br><span class="line">      - .:/code</span><br><span class="line">      - logvolume01:/var/log</span><br><span class="line">    links:</span><br><span class="line">      - redis</span><br><span class="line">  redis:</span><br><span class="line">    image: redis</span><br><span class="line">volumes:</span><br><span class="line">  logvolume01: &#123;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-安装"><a href="#2-安装" class="headerlink" title="2. 安装"></a>2. 安装</h3><p>1、直接运行下面命令：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 很慢</span><br><span class="line">sudo curl -L &quot;https://github.com/docker/compose/releases/download/1.28.2/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose</span><br><span class="line"></span><br><span class="line"># 这个快</span><br><span class="line">curl -L https://get.daocloud.io/docker/compose/releases/download/1.25.5/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure>

<p>2、授权</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grx@ubuntu:~$ sudo chmod +x /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure>

<p>安装成功</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">grx@ubuntu:~$ docker-compose version</span><br><span class="line">docker-compose version 1.25.5, build 8a1c60f6</span><br><span class="line">docker-py version: 4.1.0</span><br><span class="line">CPython version: 3.7.5</span><br><span class="line">OpenSSL version: OpenSSL 1.1.0l  10 Sep 2019</span><br></pre></td></tr></table></figure>

<h3 id="3-docker-compose-初体验"><a href="#3-docker-compose-初体验" class="headerlink" title="3. docker compose 初体验"></a>3. docker compose 初体验</h3><p>1、开发应用</p>
<p>创建工作目录：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grx@ubuntu:~/docker-study$ mkdir composetest</span><br><span class="line">grx@ubuntu:~/docker-study$ cd composetest/</span><br></pre></td></tr></table></figure>

<p>创建app.py，内容如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">cache = redis.Redis(host=<span class="string">&#x27;redis&#x27;</span>, port=<span class="number">6379</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_hit_count</span>():</span><br><span class="line">    retries = <span class="number">5</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> cache.incr(<span class="string">&#x27;hits&#x27;</span>)</span><br><span class="line">        <span class="keyword">except</span> redis.exceptions.ConnectionError <span class="keyword">as</span> exc:</span><br><span class="line">            <span class="keyword">if</span> retries == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">raise</span> exc</span><br><span class="line">            retries -= <span class="number">1</span></span><br><span class="line">            time.sleep(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello</span>():</span><br><span class="line">    count = get_hit_count()</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello World! I have been seen &#123;&#125; times.\n&#x27;</span>.<span class="built_in">format</span>(count)</span><br></pre></td></tr></table></figure>

<p>创建requirements.txt，内容如下：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flask</span><br><span class="line">redis</span><br></pre></td></tr></table></figure>

<p>2、创建Dockerfile</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">FROM python:3.7-alpine</span><br><span class="line">WORKDIR /code</span><br><span class="line">ENV FLASK_APP=app.py</span><br><span class="line">ENV FLASK_RUN_HOST=0.0.0.0</span><br><span class="line">RUN apk add --no-cache gcc musl-dev linux-headers</span><br><span class="line">COPY requirements.txt requirements.txt</span><br><span class="line">RUN pip install -r requirements.txt</span><br><span class="line">EXPOSE 5000</span><br><span class="line">COPY . .</span><br><span class="line">CMD [&quot;flask&quot;, &quot;run&quot;]</span><br></pre></td></tr></table></figure>

<p>3、在 Compose文件中定义服务</p>
<p>创建docker-compose.yml，内容如下：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">version: &quot;3.8&quot;</span><br><span class="line">services:</span><br><span class="line">  web:</span><br><span class="line">    build: .</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;5000:5000&quot;</span><br><span class="line">  redis:</span><br><span class="line">    image: &quot;redis:alpine&quot;</span><br></pre></td></tr></table></figure>

<p>4、用Compose构建并运行应用</p>
<p>docker-compose up</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">grx@ubuntu:~/docker-study/composetest$ docker-compose up</span><br><span class="line">Recreating composetest_web_1 ... done</span><br><span class="line">Starting composetest_redis_1 ... done</span><br><span class="line">Attaching to composetest_redis_1, composetest_web_1</span><br><span class="line">redis_1  | 1:C 01 Feb 2021 12:40:30.288 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span><br><span class="line">redis_1  | 1:C 01 Feb 2021 12:40:30.290 # Redis version=6.0.10, bits=64, commit=00000000, modified=0, pid=1, just started</span><br><span class="line">redis_1  | 1:C 01 Feb 2021 12:40:30.290 # Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf</span><br><span class="line">redis_1  | 1:M 01 Feb 2021 12:40:30.291 * Running mode=standalone, port=6379.</span><br><span class="line">redis_1  | 1:M 01 Feb 2021 12:40:30.291 # WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</span><br><span class="line">redis_1  | 1:M 01 Feb 2021 12:40:30.291 # Server initialized</span><br><span class="line">redis_1  | 1:M 01 Feb 2021 12:40:30.291 # WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add &#x27;vm.overcommit_memory = 1&#x27; to /etc/sysctl.conf and then reboot or run the command &#x27;sysctl vm.overcommit_memory=1&#x27; for this to take effect.</span><br><span class="line">redis_1  | 1:M 01 Feb 2021 12:40:30.291 * Loading RDB produced by version 6.0.10</span><br><span class="line">redis_1  | 1:M 01 Feb 2021 12:40:30.291 * RDB age 12 seconds</span><br><span class="line">redis_1  | 1:M 01 Feb 2021 12:40:30.291 * RDB memory usage when created 0.77 Mb</span><br><span class="line">redis_1  | 1:M 01 Feb 2021 12:40:30.291 * DB loaded from disk: 0.000 seconds</span><br><span class="line">redis_1  | 1:M 01 Feb 2021 12:40:30.292 * Ready to accept connections</span><br><span class="line">web_1    |  * Serving Flask app &quot;app.py&quot;</span><br><span class="line">web_1    |  * Environment: production</span><br><span class="line">web_1    |    WARNING: This is a development server. Do not use it in a production deployment.</span><br><span class="line">web_1    |    Use a production WSGI server instead.</span><br><span class="line">web_1    |  * Debug mode: off</span><br><span class="line">web_1    |  * Running on http://0.0.0.0:5000/ (Press CTRL+C to quit)</span><br></pre></td></tr></table></figure>

<p>测试：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">grx@ubuntu:~/docker-study/composetest$ curl localhost:5000</span><br><span class="line">Hello World! I have been seen 1 times.</span><br><span class="line">grx@ubuntu:~/docker-study/composetest$ curl localhost:5000</span><br><span class="line">Hello World! I have been seen 2 times.</span><br><span class="line">grx@ubuntu:~/docker-study/composetest$ curl localhost:5000</span><br><span class="line">Hello World! I have been seen 3 times.</span><br><span class="line"></span><br><span class="line">grx@ubuntu:~/docker-study/composetest$ docker ps</span><br><span class="line">CONTAINER ID   IMAGE             COMMAND                  CREATED              STATUS              PORTS                    NAMES</span><br><span class="line">5b8514df95f9   composetest_web   &quot;flask run&quot;              About a minute ago   Up About a minute   0.0.0.0:5000-&gt;5000/tcp   composetest_web_1</span><br><span class="line">b37f7d6a39b2   redis:alpine      &quot;docker-entrypoint.s…&quot;   3 minutes ago        Up About a minute   6379/tcp                 composetest_redis_1</span><br></pre></td></tr></table></figure>

<p>停止：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">grx@ubuntu:~/docker-study/composetest$ docker-compose down</span><br><span class="line">Stopping composetest_web_1   ... done</span><br><span class="line">Stopping composetest_redis_1 ... done</span><br><span class="line">Removing composetest_web_1   ... done</span><br><span class="line">Removing composetest_redis_1 ... done</span><br><span class="line">Removing network composetest_default</span><br></pre></td></tr></table></figure>

<p>通过docker-compose编写yaml配置文件，可以一键启动或停止所有服务！</p>
<p><strong>yaml 规则</strong></p>
<p><a href="https://link.zhihu.com/?target=https://docs.docker.com/compose/compose-file/compose-file-v3/">https://docs.docker.com/compose/compose-file/compose-file-v3/</a></p>
<h3 id="4-实战部署-WordPress"><a href="#4-实战部署-WordPress" class="headerlink" title="4. 实战部署 WordPress"></a>4. 实战部署 WordPress</h3><p>1、定义项目</p>
<p>创建目录</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grx@ubuntu:~/docker-study$ mkdir my_wordpress</span><br><span class="line">grx@ubuntu:~/docker-study$ cd my_wordpress/</span><br></pre></td></tr></table></figure>

<p>创建docker-compose.yml文件，内容如下：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">version: &#x27;3.3&#x27;</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  db:</span><br><span class="line">    image: mysql:5.7</span><br><span class="line">    volumes:</span><br><span class="line">      - db_data:/var/lib/mysql</span><br><span class="line">    restart: always</span><br><span class="line">    environment:</span><br><span class="line">      MYSQL_ROOT_PASSWORD: somewordpress</span><br><span class="line">      MYSQL_DATABASE: wordpress</span><br><span class="line">      MYSQL_USER: wordpress</span><br><span class="line">      MYSQL_PASSWORD: wordpress</span><br><span class="line"></span><br><span class="line">  wordpress:</span><br><span class="line">    depends_on:</span><br><span class="line">      - db</span><br><span class="line">    image: wordpress:latest</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;8000:80&quot;</span><br><span class="line">    restart: always</span><br><span class="line">    environment:</span><br><span class="line">      WORDPRESS_DB_HOST: db:3306</span><br><span class="line">      WORDPRESS_DB_USER: wordpress</span><br><span class="line">      WORDPRESS_DB_PASSWORD: wordpress</span><br><span class="line">      WORDPRESS_DB_NAME: wordpress</span><br><span class="line"></span><br><span class="line">volumes:</span><br><span class="line">  db_data: &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>2、构建项目</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grx@ubuntu:~/docker-study/my_wordpress$ docker-compose up -d</span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-90b0d774dc7392783d156ca7e8872c1d_1440w.webp" alt="img"></p>
<h3 id="5-实战部署SpringBoot项目"><a href="#5-实战部署SpringBoot项目" class="headerlink" title="5. 实战部署SpringBoot项目"></a>5. 实战部署SpringBoot项目</h3><p>创建SpringBoot项目，引入web和redis依赖</p>
<p>编写Controller：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// HelloController.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.example.dockerdemo.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    StringRedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">views</span> <span class="operator">=</span> redisTemplate.opsForValue().increment(<span class="string">&quot;views&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello, views=&quot;</span> + views;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编写application.properties：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server.port</span>=<span class="string">8080</span></span><br><span class="line"><span class="attr">spring.redis.host</span>=<span class="string">redis</span></span><br></pre></td></tr></table></figure>

<p>编写Dockerfile：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">FROM java:8</span><br><span class="line"></span><br><span class="line">COPY *.jar /app.jar</span><br><span class="line"></span><br><span class="line">CMD [&quot;--server.port=8080&quot;]</span><br><span class="line"></span><br><span class="line">EXPOSE 8081</span><br><span class="line"></span><br><span class="line">ENTRYPOINT [&quot;java&quot;, &quot;-jar&quot;, &quot;/app.jar&quot;]</span><br></pre></td></tr></table></figure>

<p>编写docker-compose.yml：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">version: &#x27;3.8&#x27;</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  demo-app:</span><br><span class="line">    build: .</span><br><span class="line">    image: demo-app</span><br><span class="line">    depends_on:</span><br><span class="line">      - redis</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;8081:8080&quot;  </span><br><span class="line">  redis:</span><br><span class="line">    image: &quot;library/redis:alpine&quot;</span><br></pre></td></tr></table></figure>

<p>项目打包得到 jar…</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">grx@ubuntu:~/docker-study/demo-app$ ll</span><br><span class="line">total 25788</span><br><span class="line">drwxrwxr-x 2 grx grx     4096 Feb  1 21:31 ./</span><br><span class="line">drwxrwxr-x 8 grx grx     4096 Feb  1 21:30 ../</span><br><span class="line">-rw-rw-r-- 1 grx grx      174 Feb  1 21:31 docker-compose.yml</span><br><span class="line">-rw-rw-r-- 1 grx grx 26387267 Feb  1 21:31 docker-demo-0.0.1-SNAPSHOT.jar</span><br><span class="line">-rw-rw-r-- 1 grx grx      114 Feb  1 21:31 Dockerfile</span><br></pre></td></tr></table></figure>

<p>构建项目：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grx@ubuntu:~/docker-study/demo-app$ docker-compose up -d</span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-1fc810b62eccd42fd4548a9253639f54_1440w.png" alt="img"></p>
<h3 id="十、Docker-Swarm"><a href="#十、Docker-Swarm" class="headerlink" title="十、Docker Swarm"></a>十、Docker Swarm</h3><p><strong>准备环境</strong></p>
<p>四台linux服务器，安装Docker。</p>
<p><strong>工作模式</strong></p>
<p><img src="/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-01ef4e6f3ac02d04738bad76e2b301d6_1440w.webp" alt="img"></p>
<h3 id="1-搭建集群"><a href="#1-搭建集群" class="headerlink" title="1. 搭建集群"></a>1. 搭建集群</h3><p>初始化节点：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># ubuntu-01</span><br><span class="line">grx@ubuntu:~$ docker swarm init --advertise-addr 192.168.10.101</span><br><span class="line">Swarm initialized: current node (g45sjzfi6j96xtjz9kyq9fto5) is now a manager.</span><br><span class="line"></span><br><span class="line">To add a worker to this swarm, run the following command:</span><br><span class="line"></span><br><span class="line">    docker swarm join --token SWMTKN-1-4gfig6ws393mvp1aia396is2e2hgeoo82jlor4n1gcphhr7d8m-cocg3dc29sdvu1nmory9oogvh 192.168.10.101:2377</span><br><span class="line"></span><br><span class="line">To add a manager to this swarm, run &#x27;docker swarm join-token manager&#x27; and follow the instructions.</span><br></pre></td></tr></table></figure>

<p>获取令牌：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># ubuntu-01</span><br><span class="line"># manager</span><br><span class="line">grx@ubuntu:~$ docker swarm join-token manager</span><br><span class="line">To add a manager to this swarm, run the following command:</span><br><span class="line"></span><br><span class="line">    docker swarm join --token SWMTKN-1-4gfig6ws393mvp1aia396is2e2hgeoo82jlor4n1gcphhr7d8m-4x4oqemke2583aa60xcw9mqer 192.168.10.101:2377</span><br><span class="line"></span><br><span class="line"># worker</span><br><span class="line">grx@ubuntu:~$ docker swarm join-token worker </span><br><span class="line">To add a worker to this swarm, run the following command:</span><br><span class="line"></span><br><span class="line">    docker swarm join --token SWMTKN-1-4gfig6ws393mvp1aia396is2e2hgeoo82jlor4n1gcphhr7d8m-cocg3dc29sdvu1nmory9oogvh 192.168.10.101:2377</span><br></pre></td></tr></table></figure>

<p>加入另一个节点：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># ubuntu-02</span><br><span class="line">grx@ubuntu:~$ docker swarm join --token SWMTKN-1-4gfig6ws393mvp1aia396is2e2hgeoo82jlor4n1gcphhr7d8m-cocg3dc29sdvu1nmory9oogvh 192.168.10.101:2377</span><br><span class="line">This node joined a swarm as a worker.</span><br></pre></td></tr></table></figure>

<p>查看集群内所有节点，该命令必须在manager上执行：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># ubuntu-01</span><br><span class="line">grx@ubuntu:~$ docker node ls</span><br><span class="line">ID                            HOSTNAME   STATUS    AVAILABILITY   MANAGER STATUS   ENGINE VERSION</span><br><span class="line">g45sjzfi6j96xtjz9kyq9fto5 *   ubuntu     Ready     Active         Leader           20.10.2</span><br><span class="line">tfj7m5uy8p8zbjhqhqqe06i9x     ubuntu     Ready     Active                          20.10.3</span><br></pre></td></tr></table></figure>

<p>把所有节点都加入集群：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">grx@ubuntu:~$ docker node ls</span><br><span class="line">ID                            HOSTNAME   STATUS    AVAILABILITY   MANAGER STATUS   ENGINE VERSION</span><br><span class="line">3pn00dhd23cttjiqia2fthb2a     ubuntu     Ready     Active                          20.10.3</span><br><span class="line">g45sjzfi6j96xtjz9kyq9fto5     ubuntu     Ready     Active         Leader           20.10.2</span><br><span class="line">h4d7f61anu3hgckypkyzj3hw5 *   ubuntu     Ready     Active         Reachable        20.10.3</span><br><span class="line">tfj7m5uy8p8zbjhqhqqe06i9x     ubuntu     Ready     Active                          20.10.3</span><br></pre></td></tr></table></figure>

<h3 id="2-理解Raft协议"><a href="#2-理解Raft协议" class="headerlink" title="2. 理解Raft协议"></a>2. 理解Raft协议</h3><p>保证集群主节点个数不少于3个，这样当其中一个主节点fail的时候，大多数节点可用，不影响正常运行。</p>
<p>实验一（2个manager）：</p>
<p>将ubuntu-01的docker停止，发现另外一个主节点ubuntu-04也不能使用</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># ubuntu-01</span><br><span class="line">grx@ubuntu:~$ systemctl stop docker</span><br><span class="line"></span><br><span class="line"># ubuntu-04</span><br><span class="line">grx@ubuntu:~$ docker node ls</span><br><span class="line">Error response from daemon: rpc error: code = Unknown desc = The swarm does not have a leader. It&#x27;s possible that too few managers are online. Make sure more than half of the managers are online.</span><br></pre></td></tr></table></figure>

<p>实验二（3个manager）：</p>
<p>将ubuntu-03以manager的身份加入</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># ubuntu-03</span><br><span class="line">grx@ubuntu:~$ docker node ls</span><br><span class="line">ID                            HOSTNAME   STATUS    AVAILABILITY   MANAGER STATUS   ENGINE VERSION</span><br><span class="line">3pn00dhd23cttjiqia2fthb2a     ubuntu     Down      Active                          20.10.3</span><br><span class="line">aec10kndzwetb35rhjlf7rj94 *   ubuntu     Ready     Active         Reachable        20.10.3</span><br><span class="line">g45sjzfi6j96xtjz9kyq9fto5     ubuntu     Ready     Active         Reachable        20.10.2</span><br><span class="line">h4d7f61anu3hgckypkyzj3hw5     ubuntu     Ready     Active         Leader           20.10.3</span><br><span class="line">tfj7m5uy8p8zbjhqhqqe06i9x     ubuntu     Ready     Active                          20.10.3</span><br></pre></td></tr></table></figure>

<p>此时将ubuntu-01的docker停止，另一个主节点ubuntu-04仍然可用：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># ubuntu-01</span><br><span class="line">grx@ubuntu:~$ systemctl stop docker</span><br><span class="line"></span><br><span class="line"># ubuntu-04</span><br><span class="line">grx@ubuntu:~$ docker node ls</span><br><span class="line">ID                            HOSTNAME   STATUS    AVAILABILITY   MANAGER STATUS   ENGINE VERSION</span><br><span class="line">3pn00dhd23cttjiqia2fthb2a     ubuntu     Down      Active                          20.10.3</span><br><span class="line">aec10kndzwetb35rhjlf7rj94     ubuntu     Ready     Active         Reachable        20.10.3</span><br><span class="line">g45sjzfi6j96xtjz9kyq9fto5     ubuntu     Down      Active         Unreachable      20.10.2</span><br><span class="line">h4d7f61anu3hgckypkyzj3hw5 *   ubuntu     Ready     Active         Leader           20.10.3</span><br><span class="line">tfj7m5uy8p8zbjhqhqqe06i9x     ubuntu     Ready     Active                          20.10.3</span><br></pre></td></tr></table></figure>

<p>再将ubuntu-03的docker停止，发现ubuntu-04不可用：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># ubuntu-03</span><br><span class="line">grx@ubuntu:~$ systemctl stop docker</span><br><span class="line"></span><br><span class="line"># ubuntu-04</span><br><span class="line">grx@ubuntu:~$ docker node ls</span><br><span class="line">ID                            HOSTNAME   STATUS    AVAILABILITY   MANAGER STATUS   ENGINE VERSION</span><br><span class="line">3pn00dhd23cttjiqia2fthb2a     ubuntu     Down      Active                          20.10.3</span><br><span class="line">aec10kndzwetb35rhjlf7rj94     ubuntu     Ready     Active         Unreachable      20.10.3</span><br><span class="line">g45sjzfi6j96xtjz9kyq9fto5     ubuntu     Down      Active         Unreachable      20.10.2</span><br><span class="line">h4d7f61anu3hgckypkyzj3hw5 *   ubuntu     Ready     Active         Leader           20.10.3</span><br><span class="line">tfj7m5uy8p8zbjhqhqqe06i9x     ubuntu     Ready     Active                          20.10.3</span><br><span class="line"># 一段时间后...</span><br><span class="line">grx@ubuntu:~$ docker node ls</span><br><span class="line">Error response from daemon: rpc error: code = Unknown desc = The swarm does not have a leader. It&#x27;s possible that too few managers are online. Make sure more than half of the managers are online.</span><br></pre></td></tr></table></figure>

<h3 id="3-Swarm集群弹性创建服务"><a href="#3-Swarm集群弹性创建服务" class="headerlink" title="3. Swarm集群弹性创建服务"></a>3. Swarm集群弹性创建服务</h3><blockquote>
<p>集群式：docker service</p>
</blockquote>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">grx@ubuntu:~$ docker service --help</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  create      Create a new service</span><br><span class="line">  inspect     Display detailed information on one or more services</span><br><span class="line">  logs        Fetch the logs of a service or task</span><br><span class="line">  ls          List services</span><br><span class="line">  ps          List the tasks of one or more services</span><br><span class="line">  rm          Remove one or more services</span><br><span class="line">  rollback    Revert changes to a service&#x27;s configuration</span><br><span class="line">  scale       Scale one or multiple replicated services</span><br><span class="line">  update      Update a service</span><br><span class="line"></span><br><span class="line">Run &#x27;docker service COMMAND --help&#x27; for more information on a command.</span><br></pre></td></tr></table></figure>

<p>在manager节点上启动服务：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># ubuntu-01</span><br><span class="line">grx@ubuntu:~$ docker service create -p 8888:80 --name my-nginx nginx</span><br><span class="line">ysgvv51zczqwj53z61h6l33ct</span><br><span class="line">overall progress: 1 out of 1 tasks </span><br><span class="line">1/1: running   [==================================================&gt;] </span><br><span class="line">verify: Service converged</span><br></pre></td></tr></table></figure>

<p>查看启动的服务：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># ubuntu-01</span><br><span class="line"># 目前只有1个副本</span><br><span class="line">grx@ubuntu:~$ docker service ls</span><br><span class="line">ID             NAME       MODE         REPLICAS   IMAGE          PORTS</span><br><span class="line">ysgvv51zczqw   my-nginx   replicated   1/1        nginx:latest   *:8888-&gt;80/tcp</span><br></pre></td></tr></table></figure>

<p>创建3个副本：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># ubuntu-01</span><br><span class="line">grx@ubuntu:~$ docker service update --replicas 3 my-nginx</span><br><span class="line">my-nginx</span><br><span class="line">overall progress: 3 out of 3 tasks </span><br><span class="line">1/3: running   [==================================================&gt;] </span><br><span class="line">2/3: running   [==================================================&gt;] </span><br><span class="line">3/3: running   [==================================================&gt;] </span><br><span class="line">verify: Service converged </span><br><span class="line"></span><br><span class="line"># 或者使用scale命令</span><br><span class="line"># grx@ubuntu:~$ docker service scale my-nginx=3</span><br></pre></td></tr></table></figure>

<p>需要掌握：搭建集群、启动服务、动态管理容器。</p>
<p><img src="/2024/02/22/docker-%E7%AC%94%E8%AE%B0/v2-ad76d0797c9832e68d9686b007cb2954_1440w.webp" alt="img"></p>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>阿呆
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://ddldydd.github.io/2024/02/22/docker-%E7%AC%94%E8%AE%B0/" title="docker 笔记">http://ddldydd.github.io/2024/02/22/docker-笔记/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/docker/" rel="tag"># docker</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2024/02/22/npm-%E6%8A%A5%E9%94%99%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86/" rel="prev" title="npm 报错问题处理">
      <i class="fa fa-chevron-left"></i> npm 报错问题处理
    </a></div>
      <div class="post-nav-item">
    <a href="/2024/03/04/Maven%E7%A7%81%E6%9C%8D%E6%95%99%E7%A8%8B/" rel="next" title="Maven私服教程">
      Maven私服教程 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E3%80%81Docker%E6%A6%82%E8%BF%B0"><span class="nav-number">1.</span> <span class="nav-text">一、Docker概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-Docker%E4%B8%BA%E4%BB%80%E4%B9%88%E5%87%BA%E7%8E%B0%EF%BC%9F"><span class="nav-number">2.</span> <span class="nav-text">1. Docker为什么出现？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-Docker%E7%9A%84%E5%8E%86%E5%8F%B2"><span class="nav-number">3.</span> <span class="nav-text">2. Docker的历史</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-Docker%E8%83%BD%E5%B9%B2%E5%98%9B%EF%BC%9F"><span class="nav-number">4.</span> <span class="nav-text">3. Docker能干嘛？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8C%E3%80%81Docker%E5%AE%89%E8%A3%85"><span class="nav-number">5.</span> <span class="nav-text">二、Docker安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-Docker%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%BB%84%E6%88%90"><span class="nav-number">6.</span> <span class="nav-text">1. Docker的基本组成</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%AE%89%E8%A3%85Docker"><span class="nav-number">7.</span> <span class="nav-text">2. 安装Docker</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%9B%9E%E9%A1%BEHello-World%E8%BF%87%E7%A8%8B"><span class="nav-number">8.</span> <span class="nav-text">3. 回顾Hello World过程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86"><span class="nav-number">9.</span> <span class="nav-text">4. 底层原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%89%E3%80%81Docker%E7%9A%84%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="nav-number">10.</span> <span class="nav-text">三、Docker的常用命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%B8%AE%E5%8A%A9%E5%91%BD%E4%BB%A4"><span class="nav-number">11.</span> <span class="nav-text">1. 帮助命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E9%95%9C%E5%83%8F%E5%91%BD%E4%BB%A4"><span class="nav-number">12.</span> <span class="nav-text">2. 镜像命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%AE%B9%E5%99%A8%E5%91%BD%E4%BB%A4"><span class="nav-number">13.</span> <span class="nav-text">3. 容器命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E5%B8%B8%E7%94%A8%E5%85%B6%E4%BB%96%E5%91%BD%E4%BB%A4"><span class="nav-number">14.</span> <span class="nav-text">4. 常用其他命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E5%B0%8F%E7%BB%93"><span class="nav-number">15.</span> <span class="nav-text">5. 小结</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-%E4%BD%9C%E4%B8%9A%E7%BB%83%E4%B9%A0"><span class="nav-number">16.</span> <span class="nav-text">6. 作业练习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="nav-number">17.</span> <span class="nav-text">7. 可视化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%9B%E3%80%81Docker%E9%95%9C%E5%83%8F%E8%AE%B2%E8%A7%A3"><span class="nav-number">18.</span> <span class="nav-text">四、Docker镜像讲解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E9%95%9C%E5%83%8F%E6%98%AF%E4%BB%80%E4%B9%88"><span class="nav-number">19.</span> <span class="nav-text">1. 镜像是什么</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E9%95%9C%E5%83%8F%E5%8A%A0%E8%BD%BD%E5%8E%9F%E7%90%86"><span class="nav-number">20.</span> <span class="nav-text">2. 镜像加载原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%88%86%E5%B1%82%E7%90%86%E8%A7%A3"><span class="nav-number">21.</span> <span class="nav-text">3. 分层理解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-commit%E9%95%9C%E5%83%8F"><span class="nav-number">22.</span> <span class="nav-text">4. commit镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%94%E3%80%81%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="nav-number">23.</span> <span class="nav-text">五、容器数据卷</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E4%BB%80%E4%B9%88%E6%98%AF%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="nav-number">24.</span> <span class="nav-text">1. 什么是容器数据卷</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E4%BD%BF%E7%94%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="nav-number">25.</span> <span class="nav-text">2. 使用数据卷</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%AE%9E%E6%88%98%EF%BC%9AMySQL%E5%90%8C%E6%AD%A5%E6%95%B0%E6%8D%AE"><span class="nav-number">26.</span> <span class="nav-text">3. 实战：MySQL同步数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E5%85%B7%E5%90%8D%E6%8C%82%E8%BD%BD%E5%92%8C%E5%8C%BF%E5%90%8D%E6%8C%82%E8%BD%BD"><span class="nav-number">27.</span> <span class="nav-text">4. 具名挂载和匿名挂载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E5%88%9D%E8%AF%86Dockerfile"><span class="nav-number">28.</span> <span class="nav-text">5. 初识Dockerfile</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-%E6%95%B0%E6%8D%AE%E5%8D%B7%E5%AE%B9%E5%99%A8"><span class="nav-number">29.</span> <span class="nav-text">6. 数据卷容器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%AD%E3%80%81Dockerfile"><span class="nav-number">30.</span> <span class="nav-text">六、Dockerfile</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-Dockerfile%E4%BB%8B%E7%BB%8D"><span class="nav-number">31.</span> <span class="nav-text">1. Dockerfile介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-Dockerfile%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B"><span class="nav-number">32.</span> <span class="nav-text">2. Dockerfile构建过程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-Dockerfile%E6%8C%87%E4%BB%A4"><span class="nav-number">33.</span> <span class="nav-text">3. Dockerfile指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E5%AE%9E%E6%88%98%E6%B5%8B%E8%AF%95"><span class="nav-number">34.</span> <span class="nav-text">4. 实战测试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E5%AE%9E%E6%88%98%E7%94%9F%E6%88%90%E8%87%AA%E5%AE%9A%E4%B9%89tomcat%E9%95%9C%E5%83%8F"><span class="nav-number">35.</span> <span class="nav-text">5. 实战生成自定义tomcat镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-%E5%8F%91%E5%B8%83%E8%87%AA%E5%B7%B1%E7%9A%84%E9%95%9C%E5%83%8F"><span class="nav-number">36.</span> <span class="nav-text">6. 发布自己的镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-%E5%B0%8F%E7%BB%93"><span class="nav-number">37.</span> <span class="nav-text">7. 小结</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%83%E3%80%81Docker%E7%BD%91%E7%BB%9C"><span class="nav-number">38.</span> <span class="nav-text">七、Docker网络</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E7%90%86%E8%A7%A3Docker0"><span class="nav-number">39.</span> <span class="nav-text">1. 理解Docker0</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E2%80%93link"><span class="nav-number">40.</span> <span class="nav-text">2. –link</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BD%91%E7%BB%9C"><span class="nav-number">41.</span> <span class="nav-text">3. 自定义网络</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E7%BD%91%E7%BB%9C%E8%BF%9E%E9%80%9A"><span class="nav-number">42.</span> <span class="nav-text">4. 网络连通</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E5%AE%9E%E6%88%98%EF%BC%9A%E9%83%A8%E7%BD%B2redis%E9%9B%86%E7%BE%A4"><span class="nav-number">43.</span> <span class="nav-text">5. 实战：部署redis集群</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%AB%E3%80%81SpringBoot%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%89%93%E5%8C%85Docker%E9%95%9C%E5%83%8F"><span class="nav-number">44.</span> <span class="nav-text">八、SpringBoot微服务打包Docker镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B9%9D%E3%80%81Docker-Compose"><span class="nav-number">45.</span> <span class="nav-text">九、Docker Compose</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E7%AE%80%E4%BB%8B"><span class="nav-number">46.</span> <span class="nav-text">1. 简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%AE%89%E8%A3%85"><span class="nav-number">47.</span> <span class="nav-text">2. 安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-docker-compose-%E5%88%9D%E4%BD%93%E9%AA%8C"><span class="nav-number">48.</span> <span class="nav-text">3. docker compose 初体验</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E5%AE%9E%E6%88%98%E9%83%A8%E7%BD%B2-WordPress"><span class="nav-number">49.</span> <span class="nav-text">4. 实战部署 WordPress</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E5%AE%9E%E6%88%98%E9%83%A8%E7%BD%B2SpringBoot%E9%A1%B9%E7%9B%AE"><span class="nav-number">50.</span> <span class="nav-text">5. 实战部署SpringBoot项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%81%E3%80%81Docker-Swarm"><span class="nav-number">51.</span> <span class="nav-text">十、Docker Swarm</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%90%AD%E5%BB%BA%E9%9B%86%E7%BE%A4"><span class="nav-number">52.</span> <span class="nav-text">1. 搭建集群</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E7%90%86%E8%A7%A3Raft%E5%8D%8F%E8%AE%AE"><span class="nav-number">53.</span> <span class="nav-text">2. 理解Raft协议</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-Swarm%E9%9B%86%E7%BE%A4%E5%BC%B9%E6%80%A7%E5%88%9B%E5%BB%BA%E6%9C%8D%E5%8A%A1"><span class="nav-number">54.</span> <span class="nav-text">3. Swarm集群弹性创建服务</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">阿呆</p>
  <div class="site-description" itemprop="description">书山有路勤为径，学海无涯苦作舟。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">10</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">阿呆</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">156k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">4:43</span>
</div>



<!-- 网站运行时间的设置 -->
<span id="timeDate">载入天数...</span>
<span id="times">载入时分秒...</span>
<script>
    var now = new Date();
    function createtime() {
        var grt= new Date("03/01/2023 10:00:00"); //此处修改你的建站时间或者网站上线时间
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 ";
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒.";
    }
setInterval("createtime()",250);
</script>
        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="/lib/three/three.min.js"></script>
    <script defer src="/lib/three/canvas_sphere.min.js"></script>


  




  
<script src="//cdn.jsdelivr.net/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js"></script>
<script src="//cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js"></script>
<script src="/js/algolia-search.js"></script>














  

  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>

</html>


<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/clicklove.js"></script>

<!-- 添加看板娘 -->
<script src="https://cdn.jsdelivr.net/gh/ddldydd/live2d-widget/autoload.js"></script>